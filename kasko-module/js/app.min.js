var jQueryApp=jQuery.noConflict();!function(angular){angular.module("utils",[])}(angular),function(angular){"use strict";angular.module("utils").directive("compile",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b)})}}])}(angular),function(angular,a){"use strict";angular.module("utils").directive("focusing",[function(){return{restrict:"A",link:function(b,c,d,e){function f(a){return a=a||j,a.find(".field input").filter(":visible")}function g(b){var c,d,e=f(),g=a(b.target);g.hasClass("ng-invalid")||13===b.keyCode&&(c=e.eq(e.index(b.target)+1),c.length?c.focus():(d=a("."+(+k+1)+"-is-focusing"),d.length?f(d).eq(0).focus():a("#id-after-focusing").focus()))}var h,i,j=a(c),k=_.uniqueId();j.addClass("is-focusing "+k+"-is-focusing"),setTimeout(function(){h=f(),i=h.filter(".focusing-first"),i.length?i.eq(0).focus():h.eq(1).focus(),h.on("keypress",g)},300)}}}])}(angular,jQueryApp),function(angular){"use strict";angular.module("utils").directive("ngMax",[function(){function a(a){return angular.isUndefined(a)||""===a||null===a||a!==a}return{restrict:"A",require:"ngModel",link:function(b,c,d,e){var f=function(b){var c=d.ngMax||0;return!a(b)&&b>c?void e.$setValidity(d.name,!1):(e.$setValidity(d.name,!0),b)};e.$parsers.push(f),e.$formatters.push(f),b.$watch(function(){return d.ngMax},function(a,b){a!==b&&f(e.$viewValue)})}}}])}(angular),function(angular){"use strict";angular.module("utils").directive("ngMin",[function(){function a(a){return angular.isUndefined(a)||""===a||null===a||a!==a}return{restrict:"A",require:"ngModel",link:function(b,c,d,e){var f=function(b){var c=d.ngMin||0;return!a(b)&&b<c?void e.$setValidity(d.name,!1):(e.$setValidity(d.name,!0),b)};e.$parsers.push(f),e.$formatters.push(f),b.$watch(function(){return d.ngMin},function(a,b){a!==b&&f(e.$viewValue)})}}}])}(angular),function(angular){"use strict";angular.module("utils").directive("noEmpty",[function(){function a(a){return angular.isUndefined(a)||""===a||null===a||a!==a||"0"===a||0===a}return{restrict:"A",require:"ngModel",link:function(b,c,d,e){var f=function(b){return a(b)?(e.$setValidity(d.name,!1),b):(e.$setValidity(d.name,!0),b)};e.$parsers.push(f),e.$formatters.push(f)}}}])}(angular),function(angular,a){"use strict";angular.module("utils").directive("scrollTo",[function(){return{restrict:"A",link:function(b,c,d){function e(){setTimeout(function(){f=h.offset(),g=f&&f.top||0,a("html,body").animate({scrollTop:g},"fast")},i)}var f,g,h=a(c),i=d.scrollTo?+d.scrollTo:500;h.addClass("js-scroll-to"),e()}}}])}(angular,jQueryApp),function(angular){"use strict";angular.module("utils").filter("boolFormatter",[function(){return function(a){return a?"да":"нет"}}])}(angular),function(angular){"use strict";angular.module("utils").filter("calcAge",[function(){return function(a){var b=+new Date(a);return~~((Date.now()-b)/315576e5)}}])}(angular),function(angular){"use strict";angular.module("utils").filter("dateExpired",[function(){return function(a,b){var c=new Date(a);return!(angular.isDate(c)&&!isNaN(c.getTime()))||!!b&&Math.abs((new Date-c)/864e5)>b}}])}(angular),function(angular){"use strict";angular.module("utils").filter("fioFormatter",[function(){return function(a,b){var c="";return angular.isObject(a)?void 0!==a.last_name&&void 0!==a.first_name?(c=(a.last_name||"")+" "+(a.first_name||""),"full"===b&&a.patronymic&&(c+=" "+a.patronymic),c):void 0!==a.title?(c=a.title,"full"===b&&a.full_title&&(c=a.full_title),c):"":a}}])}(angular),function(angular){angular.module("utils").filter("fractionalFormatter",[function(){return function(a,b){var c,d=parseFloat(a);if(isNaN(d))return"";for(c=d%1,b&&c&&(c=(c.toFixed(2)+"").substr(2,b)),c+="";c.length<b;)c+="0";return c}}])}(angular),function(angular){"use strict";angular.module("utils").filter("multiColumn",[function(){var a=[];return function(b,c){var d;if(!c||!angular.isArray(b))return b;if(d=_.find(a,function(a){return JSON.stringify(a.items)===JSON.stringify(b)&&JSON.stringify(a.options)===JSON.stringify(c)}))return d.filtered;var e,f=c.columns||null,g=c.rows||null,h=[[]],i=0,j=0;if(!f&&!g)throw new Error("Number of rows or columns must be specified");if(f&&g)throw new Error("Number of rows and columns can not be used simultaneously");f=f>b.length?b.length:f,g=g>b.length?b.length:g,e=f?Math.ceil(b.length/f):g;for(var k=0,l=b.length;k<l;k++,i++)i===e&&(j++,i=0,h[j]=[]),h[j].push(b[k]);return a.push({items:b,options:c,filtered:h}),h}}])}(angular),function(angular){"use strict";angular.module("utils").filter("num",[function(){return function(a){var b=parseInt(a,10);return isNaN(b)?a:b}}])}(angular),function(angular){"use strict";angular.module("utils").service("requester",["$http","CONSTS",function(a,b){function c(c){return function(d,e){return a({url:b.proxyPathC+"proxy.php",method:c,data:e,headers:{"X-Itform-Forward":d,"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:0},params:{v:Math.floor(1e8*Math.random())}})}}return{get:c("GET"),post:c("POST"),put:c("PUT")}}])}(angular),function(angular){"use strict";angular.module("utils").service("transformToFormData",function(){function a(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}return a})}(angular),function(angular){angular.module("dictionaryC",[])}(angular),function(angular){"use strict";angular.module("dictionaryC").directive("dictionary",["Dictionary","$parse",function(a,b){return{template:"{{foundResult}}",scope:{dictionary:"@",dictionaryId:"=",dictionaryArray:"=",dictionaryProp:"@"},link:function(c){function d(){var d;b(c.dictionaryProp);if(c.foundResult="",angular.isString(c.dictionary)&&""!==c.dictionary)a.findItem(c.dictionary,c.dictionaryId,c.dictionaryProp).then(function(a){return c.foundResult=a,c.foundResult});else if(angular.isArray(c.dictionaryArray))return d=_.find(c.dictionaryArray,function(a){return a.id==c.dictionaryId}),d&&c.dictionaryProp?(c.foundResult=d[c.dictionaryProp],c.foundResult):(c.foundResult=d,d)}c.$watch("dictionaryId",function(a,b){a!==b&&d()}),c.$watch("dictionaryArray",function(a,b){a!==b&&d()}),d()}}}])}(angular),function(angular,a){"use strict";angular.module("dictionaryC").provider("Dictionary",function(){var b={},c=[],d=86400,e=["$q","$filter","requester",function(e,f,g){function h(a,b,c){var d,e,f,g={};if(d=_.find(a,function(a){return b==a.id}),void 0!==d){if(angular.isArray(c))for(e=0,f=c.length;e<f;e++)g[c[e]]=d[c[e]];else g=angular.isString(c)?d[c]:d;return g}}function i(b,c,d){var e,f,g={defaults:d||{},urlParams:{}},h=b,i=g.urlParams;return angular.forEach(h.split(/\W/),function(a){if("hasOwnProperty"===a)throw angular.$$minErr("$resource")("badname","hasOwnProperty is not a valid parameter name.");!new RegExp("^\\d+$").test(a)&&a&&new RegExp("(^|[^\\\\]):"+a+"(\\W|$)").test(h)&&(i[a]=!0)}),h=h.replace(/\\:/g,":"),c=c||{},angular.forEach(g.urlParams,function(a,b){e=c.hasOwnProperty(b)?c[b]:g.defaults[b],angular.isDefined(e)&&null!==e?(f=j(e),h=h.replace(new RegExp(":"+b+"(\\W|$)","g"),function(a,b){return f+b})):h=h.replace(new RegExp("(/?):"+b+"(\\W|$)","g"),function(a,b,c){return"/"==c.charAt(0)?c:b+c}),c.hasOwnProperty(b)&&delete c[b]}),/\/+$/.test(b)||(h=h.replace(/\/+$/,"")||"/"),h=h.replace(/\/\.(?=\w+($|\?))/,"."),h=h.replace(/\/\\\./,"/."),angular.isObject(c)&&_.keys(c).length>0&&(h+="?"+a.param(c)),h}function j(a){return k(a,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function k(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,b?"%20":"+")}function l(a){if(void 0===a||""===a)throw new Error("Empty dictionary name");if(void 0===o[a])throw new Error("Invalid dictionary name: "+a);return o[a]instanceof m||(o[a]=new m(o[a]),o[a].dictName=a),!0}var m,n={},o={cities:{url:b.urlPrefixCalc+"city/:id/"},tripPurpose:{url:b.urlPrefixCalc+"trip_purpose/"},validity:{url:b.urlPrefixCalc+"validity/"},insuranceSum:{url:b.urlPrefixCalc+"insurance_sum/"},credentialTypes:{url:b.urlPrefixDefault+"client/credential-type/:id"},carMarks:{url:b.urlPrefixCalc+"car_mark/:id/",localStorage:!0},carModelGroups:{url:b.urlPrefixCalc+"car_mark/:id/car_model_group/",localStorage:!0},carModels:{url:b.urlPrefixApi+"cars/:id/",localStorage:!0},carModelPrices:{url:b.urlPrefixDefault+"car_mark/:markId/car_model/:modelId/?fields=prices&year=:year",localStorage:!1,resourceParams:{markId:"@markId",modelId:"@modelId",year:"@year"}},carModelsByGroup:{url:b.urlPrefixCalc+"car_mark/:markId/car_model_group/:id/car_model/",localStorage:!1,resourceParams:{markId:"@markId",id:"@id"}},carModifications:{url:b.urlPrefixCalc+"car_mark/:markId/car_model/:modelId/car_modification/:id",resourceParams:{markId:"@markId",modelId:"@modelId",id:"@id"}},ownerRegistration:{url:b.urlPrefixCalc+"owner_registration/",localStorage:!0},exploitationArea:{url:b.urlPrefixCalc+"exploitation_area/",localStorage:!0},carBody:{url:b.urlPrefixCalc+"car_body/",localStorage:!1},insuranceDuration:{url:b.urlPrefixCalc+"insurance_duration/",localStorage:!0},contractDurations:{url:b.urlPrefixCalc+"contract_duration/",localStorage:!1},antiThefts:{url:b.urlPrefixDefault+"antitheft/models/",localStorage:!1},carType:{url:b.urlPrefixCalc+"car_type/",localStorage:!1},contributoryScheme:{url:b.urlPrefixCalc+"contributory_scheme/",localStorage:!0},paymentForm:{url:b.urlPrefixCalc+"payment_form/",localStorage:!0},insCompanyCarModels:{url:b.host+"/car_groups/rest/groups/:id/items/"},deductibleTypes:{url:b.urlPrefixCalc+"deductible_type/",localStorage:!1},targetOfUsing:{url:b.urlPrefixCalc+"target_of_using/",localStorage:!1},coverageConditions:{url:b.urlPrefixCalc+"coverage_condition/",localStorage:!1},optionalEquipments:{url:b.urlPrefixCalc+"optional_equipment/",localStorage:!1},insuranceProductStatus:{url:b.urlPrefix+"deal/insurance-product-status/:id",localStorage:!1},insuranceType:{url:b.urlPrefixCalc+"insurance_type/"},compensationWithoutReferences:{url:b.urlPrefixCalc+"compensation_without_references/"},deductibleHarmIncident:{url:b.urlPrefixCalc+"deductible_harm_incident/"},isProlongation:{getItems:function(){var a=e.defer();return this.items=[{title:"Новый",id:!1},{title:"Из предыдущих",id:!0}],a.resolve(this.items),a.promise}},personTypes:{getItems:function(){var a=e.defer();return this.items=[{id:2,title:"Физическое лицо",shortTitle:"Физ. лицо",code:"naturalPerson"},{id:1,title:"Юридическое лицо",shortTitle:"Юр. лицо",code:"legalPerson"}],a.resolve(this.items),a.promise}},policyAreas:{url:b.urlPrefixCalc+"policy_area/",localStorage:!1},driversCountOsago:{getItems:function(){var a=e.defer();return this.items=_.map(_.range(1,11),function(a){return{id:a.toString(),title:a.toString()}}),this.items.unshift({id:0,title:"Без ограничений"}),a.resolve(this.items),a.promise}},officeAddresses:{getItems:function(){return e.when([{name:"«АвтоКлаус Центр»",address:"пр. Ленина, 93д",phone:"(831) 2-200-400"},{name:"«Автоцентр Злата»",address:"пр. Ленина, 93г",phone:"(831) 233-11-11"},{name:"«Форд Центр Нижний Новгород»",address:"Комсомольское шоссе, 12",phone:"(831) 2-330-220"},{name:"«Компания ЦЕНТР»",address:"Комсомольское шоссе, д. 5",phone:"(831) 279-40-40"}])}},driversCount:{getItems:function(){var a=e.defer();return this.items=[{title:"",item_type:"divider",code:"nat"},{title:"Ограниченный список",item_type:"header",code:"nat|active"},{id:1,title:"1 водитель",code:"nat|active"},{id:2,title:"2 водителя",code:"nat|active"},{id:3,title:"3 водителя",code:"nat|active"},{id:4,title:"4 водителя",code:"nat|active"},{id:5,title:"5 водителей",code:"nat|active"},{title:"",item_type:"divider",code:"nat"},{title:"Без ограничений",id:100,code:"nat|leg|active"}],a.resolve(this.items),a.promise}},countries:{getItems:function(){var a=e.defer();return this.items=[{id:"Азербайджан",title:"Азербайджан"},{id:"Армения",title:"Армения"},{id:"Белоруссия",title:"Белоруссия"},{id:"Казахстан",title:"Казахстан"},{id:"Киргизия",title:"Киргизия"},{id:"Молдавия",title:"Молдавия"},{id:"Таджикистан",title:"Таджикистан"},{id:"Туркмения",title:"Туркмения"},{id:"Узбекистан",title:"Узбекистан"},{id:"Украина",title:"Украина"},{id:"Грузия",title:"Грузия"},{id:"Турция",title:"Турция"},{id:"Сирия",title:"Сирия"},{id:"Тунис",title:"Тунис"},{id:"Япония",title:"Япония"},{id:"Китай",title:"Китай"},{id:"Иные",title:"Иные"}],a.resolve(this.items),a.promise}},deductibleValue:{getItems:function(){var a=e.defer();return this.items=[{id:6e3,title:6e3},{id:12e3,title:12e3},{id:2e4,title:2e4},{id:25e3,title:25e3},{id:5e4,title:5e4}],a.resolve(this.items),a.promise}},civilLiabilityVoluntaryCost:{getItems:function(){var a=e.defer();return this.items=[{id:5e5,title:5e5},{id:1e6,title:1e6},{id:15e5,title:15e5}],a.resolve(this.items),a.promise}},paymentTypes:{getItems:function(){return a.when([{title:"Банковская карта",id:"AC",img_name:"visamastercard.png"},{title:"Альфа-Клик",id:"AB",img_name:"alfaclick.jpg"},{title:"Кошелек Яндекс.Денег",id:"PC",img_name:"yandex.png"},{title:"Наличные через терминал",id:"GP",img_name:"qiwi.png"},{title:"Интернет-банк Промсвязьбанка",id:"PB",img_name:"psb.jpg"},{title:"Кошелек WebMoney",id:"WM",img_name:"webmoney.png"}])}},policyStatus:{getItems:function(){var a=e.defer();return this.items=[{id:"saved",title:"Оформление договора",code:"saved"},{id:"payed",title:"Выдан",code:"payed"},{id:"annuled",title:"Аннулирован",code:"annuled"},{id:"issued",title:"Проект договора",code:"issued"},{id:"archived",title:"Архив заключенных договоров",code:"archived"},{id:"onapproval",title:"Требует согласования",code:"onapproval"},{id:"denied",title:"Отклонен",code:"denied"}],a.resolve(this.items),a.promise}},policyActions:{getItems:function(){var a=e.defer();return this.items=[{id:"status_policy",title:"Проверить статус"},{id:"save_policy",title:"Сохранить"},{id:"print_policy",title:"Печать"},{id:"annul_policy",title:"Аннулировать"},{id:"issue_policy",title:"Оформить"}],a.resolve(this.items),a.promise}},driverLicenseAccessory:{getItems:function(){var a=e.defer();return this.items=[{id:"РФ",title:"РФ"},{id:"Иное",title:"Иное"}],a.resolve(this.items),a.promise}},keysCount:{getItems:function(){var a=e.defer();return this.items=_.map(_.range(1,4),function(a){return{id:a,title:a}}),a.resolve(this.items),a.promise}},notificationTypes:{url:b.urlPrefix+"notification/message-type",localStorage:!1},invoiceStatus:{url:b.urlPrefix+"invoice/invoice-status/:id",localStorage:!1},cbmCasco:{url:b.urlPrefixCalc+"cbm_casco/:id",localStorage:!1},osagoLossesCount:{url:b.urlPrefixCalc+"osago_losses_count/:id",localStorage:!1},specialProgram:{url:b.urlPrefixCalc+"special_program/:id",localStorage:!1},carParkSize:{url:b.urlPrefixCalc+"car_park_size/:id",localStorage:!1},prolongations:{url:b.urlPrefixCalc+"prolongation/:id",localStorage:!1},signalizationType:{url:b.urlPrefixCalc+"signalization_type/",localStorage:!1},insurantType:{url:b.urlPrefixCalc+"insurant_type/",localStorage:!1},dealCount:{url:b.urlPrefixCalc+"deal_count/",localStorage:!1},carParkSizeItems:{url:b.urlPrefixCalc+"car_park_size/",localStorage:!1},creditBank:{url:b.urlPrefixDefault+"bank/",localStorage:!1},technicalInspectionType:{url:b.urlPrefixCalc+"technical_inspection_type/",localStorage:!1},osagoRegion:{url:b.urlPrefixCalc+"osago_region/",localStorage:!1},osagoCity:{url:b.urlPrefixCalc+"osago_city/:id",localStorage:!1}};return m=function(a){this.items=[],this.dictName="",this.url="",this.cache=!0,this.localStorage=!1,this.lastUpdate="",this.lifeTime=d,this.resourceParams={id:"@id"},this._loadStack={},angular.extend(this,a),this.defaultUrl=i(this.url)},null===localStorage.getItem("lastUpdates")&&localStorage.setItem("lastUpdates",angular.toJson({})),m.prototype.load=function(a,b){var c,d;return a=a||i(this.url,b),angular.isArray(this._loadStack[a])&&this.cache?(c=e.defer(),0===this._loadStack[a].length?c.resolve(this.items[a]):this._loadStack[a].push(c),c.promise):(d=g.get(a),this.cache&&(this._loadStack[a]=[],this._loadStack[a].push(d)),d.then(function(b){var c=b.data;return this.cache&&(this.items[a]=c,this._loadStack[a].shift(),angular.forEach(this._loadStack[a],function(a){a.resolve(c)}),this._loadStack[a].length=0),this.localStorage&&(localStorage.setItem(a,angular.toJson(c)),this.setLastUpdate(a)),c}.bind(this),function(b){this.cache&&(this._loadStack[a].shift(),angular.forEach(this._loadStack[a],function(a){a.reject(b)}),this._loadStack[a].length=0)}.bind(this)))},m.prototype.setLastUpdate=function(a,b){var c=angular.fromJson(localStorage.getItem("lastUpdates"))||{};b=b||(new Date).getTime(),a=a||this.dictName,this.lastUpdate=b,c[a]=b,localStorage.setItem("lastUpdates",angular.toJson(c))},m.prototype.getLastUpdate=function(a){var b;return a=a||this.dictName,localStorage.getItem("lastUpdates")&&(b=angular.fromJson(localStorage.getItem("lastUpdates"))[a]),this.lastUpdate||b},m.prototype.checkLastUpdate=function(a){var b=this.getLastUpdate(a);return!isNaN(parseInt(b,10))&&b+1e3*this.lifeTime>(new Date).getTime()},m.prototype.getItems=function(a){var b,c=angular.isObject(a)?i(this.url,a):this.defaultUrl,d=e.defer();return this.cache&&void 0!==this.items[c]?d.resolve(angular.copy(this.items[c])):this.localStorage&&this.checkLastUpdate(c)&&(b=localStorage.getItem(c))?(b=angular.fromJson(b),this.cache&&(this.items[c]=b),d.resolve(angular.copy(b))):this.load(c,a).then(function(a){d.resolve(angular.copy(a)||[])},function(a){d.reject(a)}),d.promise},m.prototype.filter=function(a){return this.getItems().then(function(b){return f("filter")(b,a)})},m.prototype.findItem=function(a,b){var c,d=e.defer();return angular.isObject(a)&&(c=angular.copy(a),a=a.id),this.getItems(c).then(function(c){d.resolve(h(c,a,b))},function(a){d.reject(a)}),d.promise},m.prototype.loadItem=function(a){var b,c=e.defer();return void 0===a||null===a||""===a?c.reject("The params is empty"):((angular.isString(a)||angular.isNumber(a))&&(a={id:a}),b=i(this.url,a),(angular.isString(a)||angular.isNumber(a))&&(a={id:a}),g.get(b).then(function(a){c.resolve(a.data)},function(a){c.reject(a)})),c.promise},n.getItems=function(a){var b,c;try{l(a)}catch(d){console.log(d.message)}return b=Array.prototype.slice.apply(arguments),b.splice(0,1),c=o[a],c.getItems.apply(c,b)},n.findItem=function(a,b,c){var d,e;try{l(a)}catch(f){console.log(f.message)}return d=Array.prototype.slice.apply(arguments),d.splice(0,1),e=o[a],e.findItem.apply(e,d)},n.loadItem=function(a,b){var c,d;try{l(a)}catch(e){console.log(e.message)}return c=Array.prototype.slice.apply(arguments),c.splice(0,1),d=o[a],d.loadItem.apply(d,c)},n.filter=function(a,b){var c,d;try{l(a)}catch(e){console.log(e.message)}return c=Array.prototype.slice.apply(arguments),c.splice(0,1),d=o[a],d.filter.apply(d,c)},angular.forEach(c,function(a){n.getItems(a)}),n}];return{$get:e,setConstants:function(a){b=a},setLifeTime:function(a){d=a},preload:function(a){return angular.isString(a)?void(c=[a]):void(angular.isArray(a)&&(c=a))}}})}(angular,jQueryApp),function(angular){angular.module("priceFormatter",[])}(angular),function(angular,a){"use strict";angular.module("priceFormatter").directive("priceFormatter",["$filter",function(b){function c(a){if(!a.selectionStart&&document.selection){var b=document.selection.createRange().duplicate();return b.moveEnd("character",a.value.length),""===b.text?a.value.length:a.value.lastIndexOf(b.text)}return a.selectionStart}function d(a,b){if(a.setSelectionRange)a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}return a}return{restrict:"A",require:"^ngModel",link:function(e,f,g,h){var i=g.priceFormatter||0,j=/[^0-9]/g;i&&(j=/[^0-9.]/g),f=a(f),h.$parsers.push(function(a){var e,g,h,k=a.replace(j,""),l=f.val().length,m=f.get(0);return a?(e=c(m),h=b("priceFormatter")(k,i,".",!0,!0)||"0",f.val(h),g=f.val().length,d(m,e+(g-l)),k):a=0}),h.$formatters.push(function(a){return b("priceFormatter")(a,i,".",!0,!0)})}}}])}(angular,jQueryApp),function(angular){"use strict";angular.module("priceFormatter").filter("priceFormatter",[function(){var a=function(a,b,c,d,e){if(b=b||0,d=d||".",c=c||" ",0===b&&isNaN(parseInt(a,10))||isNaN(parseFloat(a))||0===a)return 0;var f,g,h,i=a<0?"-":"",j=a.toString().replace(/\s/g,"").replace(/^0+/g,"").split("."),k=j[0],l=!!b&&j[1],m=k.length>3?k.length%3:0;return e&&j[1]&&0===parseInt(j[1],10)&&(l=!1),b&&a===j[0]+"."&&(l=!0),l&&j[1].length>b&&(j[1]=j[1].substr(0,b)),f=m?k.substr(0,m)+c:"",g=k.substr(m).replace(/(\d{3})(?=\d)/g,"$1"+c),h=l?d+j[1]:"",f||g||(f="0"),i+f+g+h};return function(b,c,d,e,f){return c=c||0,d=d||",",f="string"==typeof f?f:" ",a(b,c,f,d,e)}}])}(angular),function(angular){angular.module("inputOnly",[])}(angular),function(angular){"use strict";angular.module("inputOnly").directive("inputCapitalize",[function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=function(a){void 0===a&&(a="");var b=a.toUpperCase();return b!==a&&(d.$setViewValue(b),d.$render()),b};d.$parsers.push(e),e(a[c.ngModel])}}}])}(angular),function(angular){"use strict";angular.module("inputOnly").directive("inputFloat",[function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=c.maxPrecision?+c.maxPrecision+1:null;d.$parsers.push(function(a){var b,c="";if(""===a||void 0===a||null===a)return a;var f=(a+"").replace(/[^0-9.,]/g,"");return f=f.replace(",","."),f=f.replace(/(\.[0-9]*)(\.+)/g,"$1"),f=f.replace(/^\./g,""),e&&(b=f.indexOf("."),b!==-1&&(c=f.substr(b),c.length>e&&(f=f.slice(0,e-c.length)))),f!=a&&(d.$setViewValue(f),d.$render()),f})}}}])}(angular),function(angular){"use strict";angular.module("inputOnly").directive("inputInteger",[function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){var b;return""===a||void 0===a||null===a?a:(b=(a+"").replace(/[^0-9]/g,""),b!=a&&(d.$setViewValue(b),d.$render()),b)})}}}])}(angular),function(angular){"use strict";angular.module("inputOnly").directive("inputOnly",[function(){return{restrict:"A",priority:2,require:"ngModel",link:function(a,b,c,d){var e=new RegExp(c.inputOnly,"g");e&&d.$parsers.push(function(a){var b,c="";return""===a||void 0===a||null===a?a:(b=(a+"").match(e),b&&(c=b.join("")),c!=a&&(d.$setViewValue(c),d.$render()),c)})}}}])}(angular),function(angular,a){"use strict";angular.module("inputOnly").directive("inputPhone",["$timeout",function(b){function c(a){if(!a.selectionStart&&document.selection){var b=document.selection.createRange().duplicate();return b.moveEnd("character",a.value.length),""===b.text?a.value.length:a.value.lastIndexOf(b.text)}return a.selectionStart}function d(a,b){if(a.setSelectionRange)a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}return a}return{restrict:"A",require:"ngModel",link:function(e,f,g,h){var i,j=/\+7\(\d{0,3}\)[\d]{0,3}-[\d]{0,4}/,k="+7()-";f=a(f),h.$parsers.push(function(a){var e,g,l,m=f.get(0);return null===a&&(a=""),e=j.exec(a+""),e=e?e[0]:i?i:k,i=e,g=c(m),e===k&&(l=3),6===g&&(l=7),10===g&&(l=11),11===g&&i.length>=e.length&&(l=10),7===g&&i.length>=e.length&&(l=6),void 0!==l&&b(function(){d(m,l)},0),e!=a&&(h.$setViewValue(e),h.$render()),e}),f.focus(function(){var c=a(this).val();c||(h.$setViewValue(k),h.$render(),e.$apply(function(){b(function(){d(f.get(0),3)},0)}))})}}}])}(angular,jQueryApp),function(angular){"use strict";angular.module("inputOnly").directive("inputReplace",[function(){return{priority:1e4,restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=a.$eval(c.inputReplace);if(!angular.isObject(e))throw new Error("input-replace is not a object!");d.$parsers.push(function(a){if(""===a||void 0===a||null===a)return a;var b=a;return angular.forEach(e,function(a,c){b=b.replace(new RegExp(c,"g"),a)}),b!=a&&(d.$setViewValue(b),d.$render()),b})}}}])}(angular),function(angular){"use strict";angular.module("inputOnly").directive("inputVinNumber",["vinNumberService",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){var f=a.mappedAlph;e.$parsers.push(function(b){var d,g;if(""===b||void 0===b||null===b)return b;d=b.split("");for(var h=0,i=d.length;i>h;h++)for(var j in f)f.hasOwnProperty(j)&&f[j]===d[h]&&(d[h]=j);return d=d.join("").toUpperCase().replace(/[^0-9A-HJ-NPR-Z]/g,""),d!==b&&(e.$setViewValue(d),e.$render()),g=a.vinIsValid(d),c[g?"removeClass":"addClass"]("js-vin-is-invalid"),c.parent()[g?"removeClass":"addClass"]("js-vin-is-invalid"),d})}}}])}(angular),function(angular){"use strict";angular.module("inputOnly").service("vinNumberService",[function(){function a(a){for(var b={A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,J:1,K:2,L:3,M:4,N:5,P:7,R:9,S:2,T:3,U:4,V:5,W:6,X:7,Y:8,Z:9,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,0:0},c=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2],d=0,e=0;e<a.length;e++)d+=b[a[e]]*c[e];var f=d%11;return 10==f&&(f="X"),f==a[8]}function b(b){var c="[a-hj-npr-z0-9]",d=new RegExp("^"+c+"{8}[0-9xX]"+c+"{8}$","i");return null!==b.match(d)&&a(b)}var c={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",W:"Ц",E:"У",R:"К",T:"Е",Y:"Н",U:"Г",I:"Ш",O:"Щ",P:"З",A:"Ф",S:"Ы",D:"В",F:"А",G:"П",H:"Р",J:"О",K:"Л",L:"Д",Z:"Я",X:"ч",C:"С",V:"М",B:"И",N:"Т",M:"Ь"};return{vinIsValid:b,mappedAlph:c}}])}(angular),function(angular){angular.module("ngThumb",[])}(angular),function(angular){"use strict";angular.module("ngThumb").directive("ngThumb",["$window","ngThumb",function(a,b){var c={support:!(!a.FileReader||!a.CanvasRenderingContext2D),isFile:function(b){return angular.isObject(b)&&b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(b)!==-1},isPdf:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return"|pdf|".indexOf(b)!==-1}},d=b.pdfIcon;return{restrict:"A",template:"<canvas/>",link:function(a,b,e){function f(a){var b=new Image;b.onload=g,b.src=c.isPdf(h.file)?d:a.target.result}function g(){var a=h.width||this.width/this.height*h.height,b=h.height||this.height/this.width*h.width;i.attr({width:a,height:b}),i[0].getContext("2d").drawImage(this,0,0,a,b)}if(c.support){var h=a.$eval(e.ngThumb);if(c.isFile(h.file)&&(c.isImage(h.file)||c.isPdf(h.file))){var i=b.find("canvas"),j=new FileReader;j.onload=f,j.readAsDataURL(h.file)}}}}}])}(angular),function(angular,a){"use strict";angular.module("ngThumb").provider("ngThumb",function(){var a="",b=[function(){return{pdfIcon:a}}];return{$get:b,setPdfIcon:function(b){a=b}}})}(angular,jQueryApp),function(angular){angular.module("jDatePicker",[])}(angular),function(angular,a){"use strict";angular.module("jDatePicker").directive("jdatepicker",["$parse","$timeout","jdatepicker",function(b,c,d){return{restrict:"A",priority:2,require:"ngModel",link:function(e,f,g,h){function i(b){var c,d=b,g=a.datepicker.dpDiv,j=g.find(".ui-datepicker-year").val();return angular.isString(v)&&(angular.isDate(b)||(d=a.datepicker.parseDate(t,b)),d=a.datepicker.formatDate(v,d),j!=a.datepicker._curInst.selectedYear)?(c=new Date(d),c.setFullYear(j),f.datepicker("setDate",c),i(c),void f.blur()):(h.$setViewValue(d),void e.$apply())}function j(a){var b,c;if(angular.isDate(a)){if(A&&a>new Date)return!1;if(B&&a<(new Date).setDate((new Date).getDate()))return!1;if(o.yearRange&&C)return b=o.yearRange.split(":",2),c=a.getFullYear(),c>=b[0]&&c<=b[1]}return!0}function k(a){var b=new Date(g.jdatepickerMinDate).getTime(),c=new Date(g.jdatepickerMaxDate).getTime();if(new Date(a).getTime()){if(b&&b>a)return!1;if(c&&c<a)return!1}return!0}function l(a){var b=String.fromCharCode(null===a.charCode?a.keyCode:a.charCode);return a.ctrlKey||a.metaKey||b<" "||!n||n.indexOf(b)>-1||void 0!==y[b]}var m,n,o,p=d.getDefaults(),q=(new Date).getFullYear(),r=g.jdatepickerClass||p["class"],s=void 0!==g.jdatepickerYearCount?parseInt(g.jdatepickerYearCount,10):p.yearCount,t=g.jdatepickerDateFormat||p.dateFormat,u=g.jdatepickerPDateFormat||p.pDateFormat||t,v=g.jdatepickerMDateFormat||p.mDateFormat,w=g.jdatepickerYearRange||p.yearRange||q-s+":"+q,x=g.jdatepickerValidator||null,y=void 0!==g.jdatepickerReplacedSymbols?g.jdatepickerReplacedSymbols:p.replacedSymbols,z=g.jdatepickerInputRule||p.inputRule,A=!!g.jdatepickerOnlyPast,B=!!g.jdatepickerOnlyFuture,C=void 0!==g.jdatepickerValidateYearRange?e.$eval(g.jdatepickerValidateYearRange):p.validateYearRange;f=a(f),a.datepicker.setDefaults(p),o={dateFormat:t,yearRange:w,onSelect:function(a,b){b.inline=!0,i(a)},showMonthAfterYear:!0,onClose:function(a,b){b.inline=!1}},angular.isObject(y)&&(o.constrainInput=!1),angular.isString(r)&&""!==r&&(o.beforeShow=function(){a("#ui-datepicker-div").addClass(r)}),c(function(){f.datepicker(o)},0),x&&(x=b(x),m=/\(([\dA-Za-z_$]*)(\)|,\s)/.exec(g.jdatepickerValidator),h.$parsers.unshift(function(a){var b={};return null!==m&&(b[m[1]]=a),h.$valid&&h.$setValidity(g.name,x(e,b)),a}),h.$formatters.unshift(function(a){var b={};return null!==m&&(b[m[1]]=a),h.$valid&&h.$setValidity(g.name,x(e,b)),a})),h.$parsers.unshift(function(b){return h.$setValidity(g.name,function(b){var c;try{c=a.datepicker.parseDate(t,b)}catch(d){try{c=a.datepicker.parseDate(u,b)}catch(e){return!1}return j(c)&&k(c)}return j(c)&&k(c)}(b)),b}),h.$formatters.unshift(function(b){return h.$setValidity(g.name,function(b){var c;if(angular.isDate(b))return j(b);if(angular.isString(b)){try{c=a.datepicker.parseDate(u,b)}catch(d){try{c=a.datepicker.parseDate(t,b)}catch(e){return!1}return j(c)&&k(c)}return j(c)&&k(c)}return!0}(b)),b}),h.$parsers.unshift(function(b){var c,d=u;try{c=a.datepicker.parseDate(t,b)}catch(e){return b}return angular.isString(v)&&(d=v),a.datepicker.formatDate(d,c)}),h.$formatters.unshift(function(b){var c;if(angular.isDate(b))return a.datepicker.formatDate(t,b);if(angular.isString(b)){try{c=a.datepicker.parseDate(u,b)}catch(d){c=a.datepicker.parseDate(t,b)}return a.datepicker.formatDate(t,c)}return b}),angular.isObject(y)&&(n=a.datepicker._possibleChars(t),f.on("keypress",l),h.$parsers.unshift(function(a){var b;return""===a||void 0===a||null===a?a:(b=a,angular.forEach(y,function(a,c){b=b.replace(new RegExp(c,"g"),a)}),b!=a&&(h.$setViewValue(b),h.$render()),b)})),angular.isFunction(z)&&f.on("keyup",function(a){var b,c=f.val(),d=[8,9,16,17,37,39,46];a.ctrlKey||a.metaKey||a.altKey||d.indexOf(a.keyCode)!==-1||(b=z(c),f.val(b),h.$setViewValue(b),f.datepicker("hide"))})}}}])}(angular,jQueryApp),function(angular){"use strict";angular.module("jDatePicker").provider("jdatepicker",[function(){var a={"class":"",yearCount:6,dateFormat:"yy-mm-dd",pDateFormat:null,mDateFormat:null,yearRange:null,maxDate:null,minDate:null,closeText:"Закрыть",prevText:"&#x3C;Пред",nextText:"След&#x3E;",currentText:"Сегодня",monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],dayNames:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],dayNamesShort:["вск","пнд","втр","срд","чтв","птн","сбт"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],weekHeader:"Нед",changeMonth:!0,changeYear:!0,firstDay:1,isRTL:!1,showMonthAfterYear:!0,yearSuffix:"",replacedSymbols:null,selectOtherMonths:!0,showOtherMonths:!0,validateYearRange:!0};this.setDefaults=function(b){angular.extend(a,b)},this.$get=function(){return{getDefaults:function(){return a}}}}])}(angular),function(angular){angular.module("calculatorC",[])}(angular),function(angular,a){"use strict";angular.module("calculatorC").controller("calculatorCascoCtrl",["$scope","calculatorService","CONSTS","$stateParams","Dictionary","$filter","formationPolicyService","formationPolicyStep1Service","$rootScope","ngDialog","Person","calculatorStepsService",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(b){u=b.insurance_type,y=angular.copy(b),a.params.drivers_count=b.driver_set.length,
a.params.drivers_count_full=b.driver_set.length,b.insured_object?s(b.insured_object):n()}function n(){o()}function o(b){var c=angular.copy(z);c.driver_license=h.getDefaultObject("defaultDriverLicenseObject");var d=new k(angular.extend({},c,b));a.drivers.push(d)}function p(b){var c=new k(angular.extend({},A,b));a.persons.push(c)}function q(){return(a.calculation.engine_power>9&&a.calculation.engine_power<=999||!a.calculation.engine_power)&&a.calculation.car_mark&&a.calculation.car_model&&a.calculation.car_manufacturing_year}function r(a,b){return angular.isObject(a)?angular.equals(a,b):null===a||null===b?Boolean(a)==Boolean(b):a==b}function s(a){return g.getInsuredObject(a).then(function(a){return w=angular.copy(a),t(a)})}function t(b){var c=angular.copy(b.person);return a.persons.length=0,a.drivers.length=0,b.object.vin_number?(a.osagoParams.vin_number=b.object.vin_number,a.osagoParams.vin_is_visible=!0):a.osagoParams.vin_is_visible=!1,angular.forEach(c,function(b){var c=b.natural_person?"natural_person":"legal_person";b[c].selectedPerson=b[c].external_id,"natural_person"===c?(b[c].age=f("calcAge")(b[c].birth_date),b[c].expirience=f("calcAge")(b[c].driving_experience_started)):(a.osagoParams.legal_person.inn=b[c].inn,a.osagoParams.legal_person.title=b[c].title,a.osagoParams.legal_person.insurant_is_legal_person=!0),b[c].personType=c,h.setPersonCredential(b[c]),h.setPersonAddress(b[c]),b.role.length&&_.forEach(b.role,function(a){b[c]["is"+a.slice(0,1).toUpperCase()+a.slice(1,a.length)]=!0}),"natural_person"===c&&p(angular.copy(b[c]))}),angular.forEach(b.drivers,function(a){a.personType="natural_person",a.isDriver=!0,h.setPersonCredential(a),o(a)}),a.persons.length||a.drivers.length||p(),a.drivers.length&&(b.person.length&&(a.drivers[0].person=b.person[0].id),a.persons.length=0),a.cachedDrivers=angular.copy(a.drivers),v={drivers:angular.copy(a.drivers),persons:angular.copy(a.persons)},b}var u,v,w,x=b.getPromises(),y={},z={credential:[],address:[],contact:[],first_name:"",last_name:"",patronymic:"",isDriver:!0,personType:"natural_person",birth_date:"",gender:"M",driving_experience_started:"",driver_license:h.getDefaultObject("defaultDriverLicenseObject")},A={is_same_address:!0,credential:[],isOwner:!0,personType:"natural_person",isDriver:!1,isInsurant:!1,first_name:"",last_name:"",patronymic:"",gender:"M",birth_date:"",passport:h.getDefaultObject("defaultPassportObject"),address_registration:{address_type:1,postal_index:"Нет",country:"Россия",city:"Не указан",street:"Не указана",house:"Не указан",housing:"Не указан",flat:"Не указан",kladr:""}},B=[];a.dicts={},a.dynamicDicts={},a.persons=[],a.drivers=[],a.params.field_was_clicked=!1,a.osagoParams={vin_number:"",vin_is_visible:!0,legal_person:{isOwner:!0,isInsurant:!1,inn:"",title:"",address_registration:{address_type:1,postal_index:"Нет",country:"Россия",city:"Не указан",street:"Не указана",house:"Не указан",housing:"Не указан",flat:"Не указан",kladr:""},is_same_address:!0,personType:"legal_person"}},a.getCurrentCalcType=function(){return l.getCurrentCalcType()},b.calculationFormIsValid=function(){return!0},a.templates.program_list=c.pathToModules+"calculatorC/views/"+i.calcType+"/calculation.program_list.html",a.validation={},a.isVisible=function(b,c,d){var e,f=+a.calculation.car_type;return d=d||a.calculation,"engine_power"!==b&&"target_of_using"!==b||(e=[46202,54034].indexOf(f)!==-1,"target_of_using"===b&&(c=46596)),"maximum_mass"===b&&(e=[46203,46203,54035].indexOf(f)!==-1),"seats_number"===b&&(e=[54036,54037].indexOf(f)!==-1),"vin_number"===b&&(e=[54039,54038].indexOf(f)===-1&&!Number(a.calculation.drivers_count)||a.calculation.is_legal_entity&&"false"!==a.calculation.is_legal_entity,d=a.osagoParams),e||(d[b]=c||null),e},a.isDisabled=function(b,c,d){var e;+a.calculation.car_type;return d=d||a.calculation,e&&(d[b]=c||null),e},_.isPromise(x.getCalculation)?x.getCalculation.then(m,n):a.calculation.id?b.getCalculation(a.calculation.id).then(m,n):n(),a.fieldChanged=function(a){},a.calculateKasko=function(){function b(){return a.calculate(function(b){a.cachedDrivers=angular.copy(a.drivers),a.disabledFormationPolicyButtonIsActive=!0,y=angular.copy(b)})}if(!a.params.recalculateButtonIsDisabled)return a.params.recalculateButtonIsDisabled=!0,a.params.isCalculationProgress=!0,a.root.messages.length=0,a.calculation.is_calculate_osago=!1,delete a.calculation.insurance_type,delete a.calculation.insured_object,a.calculation.deductible_value=a.postCalculateParams.second?a.params.deductible_value:null,a.calculation.contributory_scheme=a.postCalculateParams.second?a.params.contributory_scheme:19,a.calculation.payment_form=a.postCalculateParams.second?[a.params.payment_form]:null,a.calculation.deductible_type=a.calculation.deductible_value?26:null,b()},a.disabledSubmitButton=function(){return a.root.isSubmitButtonDisabled=!q()||!!a.params.isCalculationProgress,a.root.isSubmitButtonDisabled},a.addressIsValid=function(a){return a.city&&a.house&&a.street},a.getYearRange=function(a,b){var c,d,e=new Date;return a=a||0,b=void 0===b?90:b,d=e.getFullYear()-b,c=e.getFullYear()-a,d+":"+c},function(){var b=["insuranceDuration","driversCountOsago","ownerRegistration"];angular.forEach(b,function(b){a.dicts[b]=e.getItems(b).then(function(a){return B[b]=angular.copy(a),a})}),a.dicts.trueFalse=[{title:"Да",id:!0},{title:"Нет",id:!1}],a.dicts.isLegalEntity=[{title:"Физическое лицо",id:!1},{title:"Юридическое лицо",id:!0}],a.dicts.insuranceDuration=a.dicts.insuranceDuration.then(function(a){return _.filter(a,function(a){return"1year"===a.code})})}(),a.driversCountChanged=function(){var b=a.drivers.length,c=a.params.drivers_count_full;if(a.calculation.is_multidrive=!c,c&&"0"!==c?(a.persons.length=0,a.osagoParams.vin_is_visible=!1,a.osagoParams.vin_number=""):(a.persons.length=0,p(),a.osagoParams.vin_is_visible=!0),c>b)for(var d=0;c-b>d;d++)o();else a.drivers.length=+c},a.driversCountChangedSimple=function(){var c=a.calculation.driver_set.length,d=a.params.drivers_count;if(a.params.field_was_clicked){if(d>c)for(var e=0;d-c>e;e++)a.calculation.driver_set.push(angular.copy(b.defaultCalcDriver));else a.calculation.driver_set.length=+d;a.calculation.is_multidrive=!!d}},a.driversDateChanged=function(a){var b=new Date(a.birth_date),c=new Date(a.driving_experience_started),d=(new Date).setFullYear((new Date).getFullYear()-77),e=c<d,f=5679936e5;b.setDate(b.getDate()+1),a.dateIsInvalid=c-b<f||e},a.disabledFormationPolicyButton=function(){var b,c;if(c=["created_at","id","deductible_value","drivers_count","is_new_car"],y){y.car_cost=parseInt(y.car_cost,10)+"",a.calculation.car_cost=parseInt(a.calculation.car_cost,10)+"";for(b in a.calculation)if(a.calculation.hasOwnProperty(b)&&c.indexOf(b)===-1&&!r(a.calculation[b],y[b]))return a.root.isFormationPolicyButtonDisabled=!0,!0}return a.root.isFormationPolicyButtonDisabled=!1,!1},a.resetPerson=function(a){h.resetPerson(a)}}])}(angular,jQueryApp),function(angular,a){"use strict";angular.module("calculatorC").controller("calculatorCtrl",["$scope","$state","$rootScope","$stateParams","Dictionary","calculatorService","calculatorStepsService","CONSTS","$q","$location","Messages","formationPolicyStep1Service","addingDocumentsService",function(b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){b.calculationResult.sort(function(a,b){return parseFloat(a.program.sum)>parseFloat(b.program.sum)?1:-1})}var p,q={},r=30829,s=30854;b.calculationResult=[],b.params=g.calculatorOtherParams,b.templates={messages:i.pathToModules+"calculatorC/views/calculation.messages.html",navigation:i.pathToModules+"calculatorC/views/navigation.html",program_list_manager:i.pathToModules+"carFilterC/views/program_list.manager.html"},b.bigSteps=h.bigSteps,b.postCalculateParams={first:!1,second:!1,third:!1,is_visible:!1,manager__client_phone:"",manager__client_name:"",button_is_disabled:!1},b.toManager=function(){b.calculation.client_phone?b.sendToManager():b.postCalculateParams.third=!0},b.sendToManager=function(){var a=new FormData,c="",d=b.postCalculateParams.manager__client_name||b.calculation.client_name,e=b.postCalculateParams.manager__client_phone||b.calculation.client_phone;b.postCalculateParams.button_is_disabled=!0,c+="Клиент просит ему перезвонить.\n\n",c+="Имя клиента: "+d+"\n",c+="Телефон клиента: "+e+"\n\n",c+="Ссылка на расчет: http://enter.b2bpolis.ru/#/calculator/"+b.calculation.id,a.append("message",c),n.send(a).then(function(){b.postCalculateParams.button_is_disabled=!1,b.postCalculateParams.is_visible=!1,l.success("Ваш запрос принят. Мы свяжемся с вами в ближайшее время.",6e3)},function(){b.postCalculateParams.button_is_disabled=!1,l.error("Не удалось отправить запрос.",6e3)})},f.getItems("contributoryScheme").then(function(a){b.params.contributoryScheme=_.forEach(a,function(a){19!==a.id&&"Единовременно"!==a.title||(a.title="Нет")})}),f.getItems("officeAddresses").then(function(a){b.officeAddresses=a}),b.paymentForm=d.currentBrand.payment_forms,b.getResultWithKbm=function(){var a=_.find(b.calculationResult,function(a){return a.insurance_company.id===r});return a||(a=_.find(b.calculationResult,function(a){return a.insurance_company.id===s})),a},b.setStep=function(a){b.step=a},b.root={messages:[],selectedResult:g.getSelectedResult()},b.calculation=g.calculation;var t=c.params.calculationId||b.calculation&&b.calculation.id;b.disabledSecondStep=!!b.calculation.id,b.calculateType=function(){return d.calcType},b.root.insuranceTypeTitle=function(){return"Калькулятор ОСАГО"},t?(t!=b.calculation.id&&g.resetCalculation(),q.getCalculation=g.getCalculation(t).then(function(){p=angular.copy(b.calculation)}),q.getResult=g.getResult(t).then(function(a){return a&&a.length&&a?(b.calculationResult=_.filter(_.forEach(a,g.parseResult),function(a){return parseInt(a.program.sum)&&_.head(a.program.option_set)}),b.postCalculateParams.is_visible=!0,b.params.resultsAreVisible=!0,void o()):void b.root.messages.push("Ошибка со стороны страховой компании.")})):g.resetCalculation(),b.selectResult=function(a){var c=_.find(b.calculationResult,function(b){return b.id==a})||null;g.setSelectedResult(c),b.root.selectedResult=g.getSelectedResult(),c&&(b.bigSteps.setBigStep("fourth"),g.setResultAsSelected(c))},b.getYearRange=function(a,b){var c,d,e;return c=new Date,a=a||0,b=void 0===b?90:b,e=c.getFullYear()-b,d=c.getFullYear()-a,e+":"+d},b.resetCalculation=function(){b.calculation.id?l.success('Данные по расчету очищены, ваш расчет сохранен в разделе <a href="#/calculator/archive">Расчеты</a>.',7e3):l.success("Данные по расчету очищены.",4e3),g.resetCalculation(),m.resetAll(),b.calculationResult.length=0,k.search("policy",null),k.path("/calculator/"+d.calcType+"/",!1)},b.calculate=function(d){b.prevCalculationResult=angular.copy(b.calculationResult),b.calculationResult.length=0,b.selectResult(null),b.calculation.created_by_user=null,g.createCalculation().then(function(e){var f=[],h=0;b.root.messages.length=0,console.log("%c createCalculationSuccess: ","color: green"),console.warn(e),p=angular.copy(b.calculation),c.go(c.current,{calculationId:b.calculation.id},{notify:!1}),g.companiesInProgress.length&&_.forEach(g.companiesInProgress,function(a){var c=g.createResult(a.id).then(function(a){_.forEach(a,function(a){a.is_default&&parseInt(a.program.sum)&&(b.calculationResult.push(g.parseResult(a)),o(),h++,h>=5&&(b.params.recalculateButtonIsDisabled=!1))}),b.postCalculateParams.is_visible=!0});f.push(c)}),"function"==typeof d&&d(e),j.all(f).then(function(c){var d,e=_.flatten(c);return console.log("%c createResultSuccess: ","color: green"),console.warn(c),b.params.resultsAreCreated=!0,b.params.recalculateButtonIsDisabled=!1,e&&e.length?(d=a(".js-kasko-result").offset(),void(d&&jQueryApp("html,body").animate({scrollTop:d.top},"fast"))):(b.root.messages.push("Ошибка на стороне сервера."),void(b.params.isCalculationProgress=!1))},function(a){console.log("%c createResultError: ","color: red"),console.warn(a)}).then(function(a){b.params.isCalculationProgress=!1})},function(a){console.log("%c createCalculationError: ","color: red"),console.warn(a),b.root.messages.push("Не удалось создать расчет. Пожалуйста, попробуйте позже."),b.params.isCalculationProgress=!1})}}])}(angular,jQueryApp),function(angular,a){"use strict";angular.module("calculatorC").controller("calculatorOsagoCtrl",["$scope","calculatorService","CONSTS","$stateParams","Dictionary","$filter","formationPolicyService","formationPolicyStep1Service","$rootScope","ngDialog","Person","calculatorStepsService",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(b){w=b.insurance_type,A=angular.copy(b),a.params.drivers_count=b.driver_set.length,a.params.drivers_count_full=b.driver_set.length,b.insured_object?s(b.insured_object):n()}function n(){o()}function o(b){var c=angular.copy(B);c.driver_license=h.getDefaultObject("defaultDriverLicenseObject");var d=new k(angular.extend({},c,b));a.drivers.push(d)}function p(b){var c=new k(angular.extend({},C,b));a.persons.push(c)}function q(){return(a.calculation.engine_power>9&&a.calculation.engine_power<=999||!a.calculation.engine_power)&&a.calculation.car_mark&&a.calculation.car_model&&a.calculation.car_cost&&a.calculation.car_manufacturing_year}function r(a,b){return angular.isObject(a)?angular.equals(a,b):null===a||null===b?Boolean(a)==Boolean(b):a==b}function s(a){return g.getInsuredObject(a).then(function(a){return y=angular.copy(a),t(a)})}function t(b){var c=angular.copy(b.person);return a.persons.length=0,a.drivers.length=0,b.object.vin_number?(a.osagoParams.vin_number=b.object.vin_number,a.osagoParams.vin_is_visible=!0):a.osagoParams.vin_is_visible=!1,angular.forEach(c,function(b){var c=b.natural_person?"natural_person":"legal_person";b[c].selectedPerson=b[c].external_id,"natural_person"===c?(b[c].age=f("calcAge")(b[c].birth_date),b[c].expirience=f("calcAge")(b[c].driving_experience_started)):(a.osagoParams.legal_person.inn=b[c].inn,a.osagoParams.legal_person.title=b[c].title,a.osagoParams.legal_person.insurant_is_legal_person=!0),b[c].personType=c,h.setPersonCredential(b[c]),h.setPersonAddress(b[c]),b.role.length&&_.forEach(b.role,function(a){b[c]["is"+a.slice(0,1).toUpperCase()+a.slice(1,a.length)]=!0}),"natural_person"===c&&p(angular.copy(b[c]))}),angular.forEach(b.drivers,function(a){a.personType="natural_person",a.isDriver=!0,h.setPersonCredential(a),o(a)}),a.persons.length||a.drivers.length||p(),a.drivers.length&&(b.person.length&&(a.drivers[0].person=b.person[0].id),a.persons.length=0),a.cachedDrivers=angular.copy(a.drivers),x={drivers:angular.copy(a.drivers),persons:angular.copy(a.persons)},b}function u(){var b=a.drivers.length?a.drivers:a.persons,c={car:{car_mark:a.calculation.car_mark,car_model:a.calculation.car_model,car_model_group:a.calculation.car_model_group||null,manufacturing_date:a.calculation.car_manufacturing_year+"-01-01",engine_power:a.calculation.engine_power,cost:0,vin_number:a.osagoParams.vin_number},persons:b};return g.createInsuredObjectOsago(c)}function v(a){return a=a||new Date,f("date")(a,"yyyy-MM-dd")}var w,x,y,z=b.getPromises(),A={},B={credential:[],address:[],contact:[],first_name:"",last_name:"",patronymic:"",isDriver:!0,personType:"natural_person",birth_date:"",gender:"M",driving_experience_started:"",driver_license:h.getDefaultObject("defaultDriverLicenseObject")},C={is_same_address:!0,credential:[],isOwner:!0,personType:"natural_person",isDriver:!1,isInsurant:!1,first_name:"",last_name:"",patronymic:"",gender:"M",birth_date:"",passport:h.getDefaultObject("defaultPassportObject"),address_registration:{address_type:1,postal_index:"Нет",country:"Россия",city:"Не указан",street:"Не указана",house:"Не указан",housing:"Не указан",flat:"Не указан",kladr:""}},D=[];a.dicts={},a.dynamicDicts={},a.persons=[],a.drivers=[],a.params.field_was_clicked=!1,a.osagoParams={vin_number:"",vin_is_visible:!0,legal_person:{isOwner:!0,isInsurant:!1,inn:"",title:"",address_registration:{address_type:1,postal_index:"Нет",country:"Россия",city:"Не указан",street:"Не указана",house:"Не указан",housing:"Не указан",flat:"Не указан",kladr:""},is_same_address:!0,personType:"legal_person"}},a.getCurrentCalcType=function(){return l.getCurrentCalcType()},b.calculationFormIsValid=function(){return!0},a.templates.program_list=c.pathToModules+"calculatorC/views/"+i.calcType+"/calculation.program_list.html",a.validation={},a.isVisible=function(b,c,d){var e,f=+a.calculation.car_type;return d=d||a.calculation,"engine_power"!==b&&"target_of_using"!==b||(e=[46202,54034].indexOf(f)!==-1,"target_of_using"===b&&(c=46596)),"maximum_mass"===b&&(e=[46203,46203,54035].indexOf(f)!==-1),"seats_number"===b&&(e=[54036,54037].indexOf(f)!==-1),"vin_number"===b&&(e=[54039,54038].indexOf(f)===-1&&!Number(a.calculation.drivers_count)||a.calculation.is_legal_entity&&"false"!==a.calculation.is_legal_entity,d=a.osagoParams),e||(d[b]=c||null),e},a.isDisabled=function(b,c,d){var e;+a.calculation.car_type;return d=d||a.calculation,e&&(d[b]=c||null),e},_.isPromise(z.getCalculation)?z.getCalculation.then(m,n):a.calculation.id?b.getCalculation(a.calculation.id).then(m,n):n(),a.fieldChanged=function(b){"is_legal_entity"===b&&a.calculation.is_legal_entity&&"true"!==a.calculation.is_legal_entity&&(a.params.drivers_count=0,a.params.drivers_count_full=0,a.params.field_was_clicked=!1,a.driversCountChanged(),a.calculation.driver_set.length=0,a.calculation.is_multidrive=!0)},a.calculateOsago=function(){function b(){return a.calculate(function(b){a.cachedDrivers=angular.copy(a.drivers),a.disabledFormationPolicyButtonIsActive=!0,A=angular.copy(b)})}var c=[],d=[];if(!a.params.isCalculationProgress){if(a.params.isCalculationProgress=!0,a.root.messages.length=0,a.calculation.is_calculate_osago=!0,a.calculation.car_cost="0",a.calculation.drivers_count=a.params.drivers_count,delete a.calculation.insurance_type,delete a.calculation.insured_object,a.calculation.is_legal_entity&&"false"!==a.calculation.is_legal_entity?a.calculation.calculation_type=45427:a.calculation.calculation_type=45426,"full"!==a.getCurrentCalcType())return b();a.calculation.drivers_count=a.params.drivers_count_full,a.calculation.driver_set.length=0,angular.forEach(a.drivers,function(b){var e=f("calcAge")(b.birth_date),g=f("calcAge")(b.driving_experience_started);b.isDriver=!0,b.personType="natural_person",a.calculation.driver_set.push({age:e||18,expirience:g,is_married:!1,has_children:!1}),c.push(e),d.push(g),b.birth_date=v(b.birth_date),b.driving_experience_started=v(b.driving_experience_started),b.driver_license.credential_type=3,b.credential=[angular.copy(b.driver_license)]}),angular.forEach(a.persons,function(a){a.birth_date=v(a.birth_date),a.isDriver=!1,a.credential=[a.passport]}),!a.drivers.length&&a.calculation.is_legal_entity&&"false"!==a.calculation.is_legal_entity&&(a.persons=[a.osagoParams.legal_person]),a.calculation.drivers_minimal_age=Math.min.apply(Math,c),a.calculation.drivers_minimal_experience=Math.min.apply(Math,d),x={drivers:angular.copy(a.drivers),persons:angular.copy(a.persons)},u().then(function(c){a.calculation.insured_object=c.id||null,b()},function(){a.root.messages.push("Ошибка при сохранении объекта страхования."),a.params.isCalculationProgress=!1})}},a.disabledSubmitButton=function(){return a.root.isSubmitButtonDisabled=!q()||!!a.params.isCalculationProgress,a.root.isSubmitButtonDisabled},a.addressIsValid=function(a){return a.city&&a.house&&a.street},a.getYearRange=function(a,b){var c,d,e=new Date;return a=a||0,b=void 0===b?90:b,d=e.getFullYear()-b,c=e.getFullYear()-a,d+":"+c},function(){var b=["insuranceDuration","driversCountOsago","ownerRegistration"];angular.forEach(b,function(b){a.dicts[b]=e.getItems(b).then(function(a){return D[b]=angular.copy(a),a})}),a.dicts.trueFalse=[{title:"Да",id:!0},{title:"Нет",id:!1}],a.dicts.isLegalEntity=[{title:"Физическое лицо",id:!1},{title:"Юридическое лицо",id:!0}],a.dicts.insuranceDuration=a.dicts.insuranceDuration.then(function(a){return _.filter(a,function(a){return"1year"===a.code})})}(),a.driversCountChanged=function(){var b=a.drivers.length,c=a.params.drivers_count_full;if(a.calculation.is_multidrive=!c,c&&"0"!==c?(a.persons.length=0,a.osagoParams.vin_is_visible=!1,a.osagoParams.vin_number=""):(a.persons.length=0,p(),a.osagoParams.vin_is_visible=!0),c>b)for(var d=0;c-b>d;d++)o();else a.drivers.length=+c},a.driversCountChangedSimple=function(){var c=a.calculation.driver_set.length,d=a.params.drivers_count;if(a.params.field_was_clicked){if(d>c)for(var e=0;d-c>e;e++)a.calculation.driver_set.push(angular.copy(b.defaultCalcDriver));else a.calculation.driver_set.length=+d;a.calculation.is_multidrive=!!d}},a.driversDateChanged=function(a){var b=new Date(a.birth_date),c=new Date(a.driving_experience_started),d=(new Date).setFullYear((new Date).getFullYear()-77),e=c<d,f=5679936e5;b.setDate(b.getDate()+1),a.dateIsInvalid=c-b<f||e},a.disabledFormationPolicyButton=function(){var b,c;if(c=["created_at","id","deductible_value","drivers_count","is_new_car"],A){A.car_cost=parseInt(A.car_cost,10)+"",a.calculation.car_cost=parseInt(a.calculation.car_cost,10)+"";for(b in a.calculation)if(a.calculation.hasOwnProperty(b)&&c.indexOf(b)===-1&&!r(a.calculation[b],A[b]))return a.root.isFormationPolicyButtonDisabled=!0,!0}return a.root.isFormationPolicyButtonDisabled=!1,!1},a.resetPerson=function(a){h.resetPerson(a)}}])}(angular,jQueryApp),function(angular){"use strict";angular.module("calculatorC").controller("calculatorNavigationCtrl",["$scope","$state","calculatorService","$rootScope","calculatorStepsService",function(a,b,c,d,e){function f(a){return function(){return a.test(b.current.name)}}function g(){return e.bigSteps.getBigStep()}a.calculation=c.calculation,a.navigation=function(){var a=[{active:function(){return f(/index.calculator/)()&&"first"===g().name},link:"index.calculator."+d.calcType,title:"Ваш автомобиль",onClick:function(){e.bigSteps.setBigStep("first")},additional_conditions:{},icon:"car"},{active:function(){return f(/index.calculator/)()&&"second"===g().name},link:"index.calculator."+d.calcType,title:"Параметры расчета",onClick:function(){e.bigSteps.setBigStep("second")},condition_disabled:function(){var a=c.calculation;return!parseInt(a.car_cost)&&"third"!==g().name},additional_conditions:{},icon:"options"},{active:function(){return"third"===g().name},onClick:function(){e.bigSteps.setBigStep("third")},link:"index.addingDocuments",title:"Тариф",condition_disabled:function(){return["third","fourth"].indexOf(g().name)===-1&&!c.getSelectedResult()},additional_conditions:{},icon:"tasks"},{active:function(){return"fourth"===g().name},onClick:function(){e.bigSteps.setBigStep("fourth")},link:"index.ordering",title:"Заказ",condition_disabled:function(){return!c.getSelectedResult()},icon:"checked calendar"}];return _.forEach(a,function(a){"function"!=typeof a.isHidden&&(a.isHidden=_.noop),"function"!=typeof a.condition_disabled&&(a.condition_disabled=_.noop),"function"!=typeof a.onClick&&(a.onClick=_.noop)}),a}(),a.goToStep=function(e){var f=c.getSelectedResult();b.go(a.navigation[e].link,{calculationId:a.calculation.id||b.params.calculationId,calcType:d.calcType||"osago",companyId:f&&f.id||b.params.companyId},{reload:!1})}}])}(angular),function(angular,a){"use strict";angular.module("calculatorC").directive("goToCalculation",["$state","$rootScope","calculatorService","formationPolicyService","$timeout","formationPolicyStep1Service",function(b,c,d,e,f,g){return{restrict:"AC",scope:{calcType:"@",params:"=goToCalculation",transitionParams:"=",options:"=transitionOptions"},link:function(h,i,j,k){var l=a(i);l.click(function(a){var i=h.options||{},j=i.calcType||c.calcType,k=h.params||{},m=h.transitionParams||{};return!l.hasClass("disabled")&&!l.is(":disabled")&&(a.preventDefault(),c.calcType=j,k.rsa=b.params.rsa,f(function(){(i.resetCalc||i.resetAll)&&(g.resetAll(),d.resetCalculation()),(i.resetPolicy||i.resetAll)&&(g.resetAll(),e.resetCurrentPolicy())},0),void b.go("index.calculator."+j,k,m))})}}}])}(angular,jQueryApp),function(angular){"use strict";angular.module("calculatorC").provider("calculator",[function(){var a={id:null,car_cost:0,car_mark:null,car_model_group:null,car_model:null,car_manufacturing_year:null,exploitation_area:null,owner_registration:null,drivers_count:0,driver_set:[],drivers_minimal_age:null,drivers_minimal_experience:null,is_multidrive:!1,target_of_using:null,insurance_duration:null,contributory_scheme:null,payment_type:null,mileage:null,insurable_risk:null,claim_form:null,payment_form:null,deductible_value:null,civil_liability_voluntary_cost:null,car_type:null,insured_object:null,count_years_break_even_insurance:0,calculation_at_date:null,insurance_type:null,has_foreign_registration:!1,maximum_mass:null,seats_number:null,engine_power:null,is_legal_entity:!1,has_trailer:!1,calculation_type:null,is_earlier_insurance:null,antitheft:null,is_credit:null};this.setDefaults=function(b){angular.extend(a,b)},this.$get=function(){return{getDefaults:function(){return a}}}}])}(angular),function(angular,a){"use strict";angular.module("calculatorC").service("calculatorService",["$http","$q","CONSTS","$rootScope","resources","calculator","$filter","requester",function(b,c,d,e,f,g,h,i){function j(b){var c=a(".ui-datepicker-year").val();return(b=new Date(b))?(b.setFullYear(c),h("date")(b,"yyyy-MM-dd")):""}var k=g.getDefaults(),l=function(a){return a=a||new Date,h("date")(a,"yyyy-MM-dd")},m={full_year:null,field_was_clicked:!1,drivers_count:1,drivers_count_full:1,signalization_type:"",show_empty_fields:!1,resultsAreCreated:!1,deductible_value:15e3,contributory_scheme:19,payment_form:107,recalculateButtonIsDisabled:!1,isCalculationProgress:!1,resultsAreVisible:!1,office_addresses:0};this.parseResult=function(a){return a.company_logo="http://enter.b2bpolis.ru/"+a.insurance_company.logo,a},this.currentResult=null,this.getOtherCompanies=function(){return[{id:41243,title:"Росгосстрах",insurance_company:{logo:"media/logo_main_ins/Logo_24.png"}},{id:41465,title:"Ренессанс",insurance_company:{logo:"media/logo_main_ins/Logo_47.png"}}]},this.calculation=angular.copy(k),this.companiesInProgress=[],this.getDefaultCalculation=function(){return k},this.selectedResult=null,this.setSelectedResult=function(a){this.selectedResult=a},this.getSelectedResult=function(){return this.selectedResult},this.calculationFormIsValid=_.noop,this._promises={},this.getPromises=function(){return this._promises},this.calculatorOtherParams=angular.copy(m),this.resetCalculation=function(a){var b=angular.copy(this.getDefaultCalculation());this.companiesInProgress.length=0,a=a||e.calcType;for(var c in this.calculation)this.calculation.hasOwnProperty(c)&&delete this.calculation[c];for(var d in b)b.hasOwnProperty(d)&&(this.calculation[d]=b[d]);for(var f in this.calculatorOtherParams)this.calculatorOtherParams.hasOwnProperty(f)&&(this.calculatorOtherParams[f]=m[f]);return this["to_defaults_"+a]&&this["to_defaults_"+a](),this},this.to_defaults_osago=function(){var a=new Date;a.setDate(a.getDate()+1),this.calculation.insurance_duration=82,this.calculation.driver_set=[angular.copy(this.defaultCalcDriver)],this.calculation.car_type=1,this.calculation.drivers_count=1,this.calculation.calculation_at_date=l(a)},this.to_defaults_kasko=function(){var a=new Date;a.setDate(a.getDate()+1),this.calculation.insurance_duration=82,this.calculation.deductible_currency=23,this.calculation.driver_set=[angular.copy(this.defaultCalcDriver)],this.calculation.car_type=1,this.calculation.drivers_count=1,this.calculation.calculation_at_date=l(a)},this.defaultCalcDriver={is_married:!1,gender:"M",expirience:null,age:null,has_children:!1},this.createCalculation=function(a){return a=a||this.calculation,this.companiesInProgress.length=0,a=this.correctCalculation(a),delete a.token,i.post(f.calculation+"?token",a).then(function(a){var b,c=a.data,d=["optional_equipment"];this.calculationToken=c.token,this.companiesInProgress=c.available_insurance_departments,delete c.available_insurance_departments;for(b in c)c.hasOwnProperty(b)&&d.indexOf(b)===-1&&(angular.equals(this.calculation[b],c[b])||(this.calculation[b]=c[b]));return a.data}.bind(this))},this.getCalculation=function(a){return a=a||this.calculation.id,a==this.calculation.id?c.when(this.calculation):(this._promises.getCalculation=i.get(f.calculation+a+"/").then(function(a){var b;a=a.data;for(b in a)"user"!==b&&(this.calculation[b]=a[b]);return this.calculation}.bind(this)),this._promises.getCalculation)},this.getResult=function(a){return a=a||this.calculation.id,i.get(f.calculationV3+a+"/result/?insurance_company=1&messages=1&variables=1&options=1").then(function(a){return this.companiesInProgress=a.data,this.currentResult=a.data,a.data}.bind(this))},this.createResult=function(a,c){var d=this.calculationToken;return c=c||this.calculation.id,b({url:"http://enter.b2bpolis.ru"+f.calculationV3+c+"/result/"+a+"/?insurance_company=1&messages=1&variables=1&options=1",method:"POST",headers:{"X-Calculation-Token":d}}).then(function(a){return this.companiesInProgress=a.data,this.currentResult=a.data,a.data}.bind(this))},this.setResultAsSelected=function(a,c){var d=this.calculationToken;return c=c||this.calculation.id,b({url:"http://enter.b2bpolis.ru"+f.calculationV3+c+"/result/"+a.insurance_company.version+"/?insurance_company=1&messages=1&variables=1&options=1",method:"PUT",headers:{"X-Calculation-Token":d},data:angular.extend({},a,{is_selected:!0,is_default:!0})}).then(function(a){return a.data})},this.getCredentialList=function(a){return b.get(d.urlPrefixDefault+"client/natural-person/"+a+"/credential").then(function(a){return a.data})},this.getAddressList=function(a){return b.get(d.urlPrefixDefault+"client/natural-person/"+a+"/address").then(function(a){return a.data})},this.correctCalculation=function(a){return a=a||this.calculation},this.personDateChanged=function(a,b,c){b=b||"birth_date",b.indexOf(".")!==-1?(b=b.split("."),a[b[0]][b[1]]=j(a[b])):a[b]=j(a[b])},this.validateDrivers=function(){var a,b,c=this.calculation.driver_set.length;if(this.calculation.is_multidrive,0===c)return!0;for(a=0;a<c;a++)if(b=this.calculation.driver_set[a],b.age-b.expirience<17)return!1;return!0}}])}(angular,jQueryApp),function(angular){"use strict";angular.module("calculatorC").service("calculatorStepsService",[function(){var a={year:{name:"year"},car:{name:"car"},car_mark:{name:"car_mark"},car_group_model:{name:"car_group_model"},car_model:{name:"car_model"},engine_power:{name:"engine_power"},exploitation_area:{name:"exploitation_area"},car_cost:{name:"car_cost"},mileage:{name:"mileage"},drivers:{name:"drivers"},drivers_count:{name:"drivers_count"},multidrive:{name:"multidrive"},first:{name:"first"},second:{name:"second"},third:{name:"third"},fourth:{name:"fourth"},is_earlier_insurance:{name:"is_earlier_insurance"},is_credit:{name:"is_credit"},contributory_scheme:{name:"contributory_scheme"},antitheft:{name:"antitheft"}};this.getCurrentCalcType=_.noop,this.calculation_type=null;var b={activeState:"year",activeStateSecond:"drivers_count",activeBigStep:"first"};this.getActiveStep=function(){return a[b.activeState]},this.setActiveStep=function(a){b.activeState=a},this.getActiveStepSecond=function(){return a[b.activeStateSecond]},this.setActiveStepSecond=function(a){b.activeStateSecond=a},this.bigSteps={getBigStep:function(){return a[b.activeBigStep]},setBigStep:function(a){b.activeBigStep=a}}}])}(angular),function(angular){angular.module("person",[])}(angular),function(angular){"use strict";angular.module("person").factory("Person",["resources","$q","$http","CONSTS",function(a,b,c,d){function e(a){var b;return b="legal_person"===a._personType?["title"]:["first_name","last_name","patronymic","birth_date","gender"],_.pick(a,b)}var f;return f=function(b){b=b||{},"legal_person"===b.personType?(this._personType="legal_person",this._resourcePrefix=a.legalPerson):(this._personType="natural_person",this._resourcePrefix=a.naturalPerson),this.credential=[],this.contact=[],this.address=[],this.extend(b)},f.prototype.extend=function(a){angular.extend(this,a)},f.prototype.get=function(a,b){
var d=a||this.id||null;if(null===d)throw new Error("id is null!");return c.get(this._resourcePrefix+"/"+a,b).then(function(a){return this.extend(a.data),a.data}.bind(this))},f.prototype.getCredentialList=function(){return this._getList("credential")},f.prototype.getContactList=function(){return this._getList("contact")},f.prototype.getAddressList=function(){return this._getList("address")},f.prototype._getList=function(a){var d;return this.id?c.get(this._resourcePrefix+"/"+this.id+"/"+a).then(function(b){return this[a]=b.data,this[a]}.bind(this)):(d=b.defer(),d.resolve(this[a]),d.promise)},f.prototype.addCredential=function(a){return this._addItem("credential",a)},f.prototype.addContact=function(a){return this._addItem("contact",a)},f.prototype.addAddress=function(a){return this._addItem("address",a)},f.prototype._addItem=function(a,b){if(!angular.isArray(this[a]))throw new Error(a+" of person is not array");return this[a].push(b),b},f.prototype.saveCredentialList=function(){return this._saveList("credential")},f.prototype.saveContactList=function(){return this._saveList("contacts")},f.prototype.saveAddressList=function(){return this._saveList("address")},f.prototype._saveList=function(a,d,e){var f=[],g=this;if(this[a])return angular.forEach(this[a],function(b){var h,i="post",j=g._resourcePrefix+"/"+g.id+"/"+a;b.id&&(i="put",j+="/"+b.id),h=c[i](j,b),h.then(function(a){return angular.extend(b,a.data),a.data}),angular.isFunction(d)&&h.then(d),angular.isFunction(e)&&h["catch"](e),f.push(h)}),b.all(f)},f.prototype.removeContact=function(a){return this._removeItem("contact",a)},f.prototype.removeAddress=function(a){return this._removeItem("address",a)},f.prototype.removeCredential=function(a){return this._removeItem("credential",a)},f.prototype._removeItem=function(a,d){var e=b.defer();return this[a]&&(d.id?c["delete"](this._resourcePrefix+"/"+this.id+"/"+a+"/"+d.id).then(function(){this[a]=_.reject(this[a],function(a){return d===a}),e.resolve(this[a])}.bind(this),function(a){e.reject(a)}):(this[a]=_.reject(this[a],function(a){return d===a}),e.resolve(this[a]))),e.promise},f.prototype.save=function(){var a="post",b=this._resourcePrefix;return this.id&&(a="put",b+="/"+this.id),c[a](b,e(this)).then(function(a){return this.extend(a.data),a.data}.bind(this))},f.prototype.remove=function(){var a=b.defer();return this.id?c["delete"](this._resourcePrefix+"/"+this.id):(a.reject("Person hasn't id"),a.promise)},f.prototype.saveAll=function(){var a=b.defer();return this.save().then(function(c){var d=[];d.push(this.saveCredentialList()),d.push(this.saveAddressList()),b.all(d).then(function(b){a.resolve({person:c,credential:b[0],address:b[1]})},function(b){a.reject(b)})}.bind(this),function(b){a.reject(b)}),a.promise},f}])}(angular),function(angular){"use strict";angular.module("person").service("personService",["$http","$q","CONSTS","resources",function(a,b,c,d){return{getNaturalPerson:function(b){return a.get(d.naturalPerson+"/"+b).then(function(a){return a.data})},getNaturalPersonData:function(c){var e={id:c},f=[];return f.push(a.get(d.naturalPerson+"/"+e.id+"/credential").then(function(a){return a.data})),f.push(a.get(d.naturalPerson+"/"+e.id+"/address").then(function(a){return a.data})),f.push(a.get(d.naturalPerson+"/"+e.id+"/contact").then(function(a){return a.data})),b.all(f).then(function(a){var b=a[0],c=a[1],d=a[2];return e.driver_license=_.find(b,function(a){return 3===a.credential_type}),e.passport=_.find(b,function(a){return 1===a.credential_type}),e.address_registration=_.find(c,function(a){return 1===a.address_type}),e.address_residential=_.find(c,function(a){return 2===a.address_type}),e.contactData=function(){var a=_.find(d,function(a){return 1===a.contact_type}),b=_.find(d,function(a){return 2===a.contact_type});return{phone:a,email:b}}(),e})},saveNaturalPersonFull:function(a){var c={},d=_.pick(a,["first_name","last_name","patronymic","birth_date","gender","id","driving_experience_started"]);return c.person=this.saveNaturalPerson(d),a.driver_license&&(angular.extend(a.driver_license,{credential_type:3}),c.driver_license=this.saveNaturalPersonCredential(a.id,a.driver_license)),a.passport&&(angular.extend(a.passport,{credential_type:1}),c.passport=this.saveNaturalPersonCredential(a.id,a.passport)),a.contactData&&a.contactData.phone&&a.contactData.phone.data&&(c.phone=this.saveNaturalPersonContact(a.id,angular.extend(a.contactData.phone,{contact_type:1}))),a.contactData&&a.contactData.email&&a.contactData.email.data&&(c.email=this.saveNaturalPersonContact(a.id,angular.extend(a.contactData.email,{contact_type:2}))),a.address_registration&&(angular.extend(a.address_registration,{address_type:1}),c.address_registration=this.saveNaturalPersonAddress(a.id,a.address_registration)),a.address_residential&&(angular.extend(a.address_residential,{address_type:1}),c.address_residential=this.saveNaturalPersonAddress(a.id,a.address_residential)),b.all(c).then(function(a){var b=angular.extend(a.person,a);return delete b.person,b})},saveNaturalPerson:function(b){var c="post",e=d.naturalPerson;return b.id&&(c="put",e+="/"+b.id),a[c](e,b).then(function(a){return a.data})},saveNaturalPersonCredential:function(b,c){var e="post",f=d.naturalPerson+"/"+b+"/credential";return c.id&&(e="put",f+="/"+c.id),a[e](f,c).then(function(a){return a.data})},saveNaturalPersonAddress:function(b,c){var e="post",f=d.naturalPerson+"/"+b+"/address";return c.id&&(e="put",f+="/"+c.id),a[e](f,c).then(function(a){return a.data})},saveNaturalPersonContact:function(b,c){var e="post",f=d.naturalPerson+"/"+b+"/contact";return c.id&&(e="put",f+="/"+c.id),a[e](f,c).then(function(a){return a.data})}}}])}(angular),function(angular){angular.module("formationPolicyC",[])}(angular),function(angular){"use strict";angular.module("formationPolicyC").service("formationPolicyService",["$http","CONSTS","$q","$rootScope","$filter","resources","requester",function(a,b,c,d,e,f,g){function h(){return null}function i(a){return a=a||new Date,e("date")(a,"yyyy-MM-dd")}function j(a){var b;return b="legal_person"===a.personType?["title","title_eng","id","inn","ogrn","kpp","representative_first_name","representative_last_name","representative_patronymic","representative_post","representative_credential_type","representative_number","representative_issue_date"]:["id","first_name","last_name","patronymic","first_name_eng","last_name_eng","patronymic_eng","birth_date","gender","driving_experience_started","is_individual_entrepreneur","is_foreigner"],_.pick(a,b)}var k={object:{credential:[{issue_date:"2016-02-04",creator:10585,series:"3456",number:"45",object_id:1751,issue_point:"",credential_type:10,content_type:480,expiration_date:null,external_id:"9374",id:5449}],keys_count:2,manufacturing_date:"2015-01-01",engine_power:"200.00",car_modification:null,creator:10585,car_model:7687,engine_displacement:"2.00",car_body_number:null,mileage:null,number_plate:"",car_mark:303,vin_number:"55TTEEE5E5R5R6TT7",external_id:"7628",id:1751,cost:null},object_type:"car",person:[]},l=null,m=null,n={clear:function(){m=null},resetCurrentPolicy:function(){l=null},updateCustomer:function(b){var d=c.defer(),e=h();return this.getCustomer(e).then(function(c){c.natural_persons=c.natural_persons.concat(b.natural_persons),c.natural_persons=_.uniq(c.natural_persons),a.put(f.customer+"/"+e,c).then(function(a){d.resolve(a.data)},function(a){d.reject(a)})},function(a){d.reject(a)}),d.promise},getCustomer:function(b){return b=b||h(),a.get(f.customer+"/"+b).then(function(a){return a.data})},getCustomerCars:function(b){return b=b||h(),a.get(f.customerCar,{params:{owner:b}}).then(function(a){return a.data})},getCarCredential:function(b){return a.get(f.customerCar+"/"+b+"/credential").then(function(a){return a.data})},getCustomerFull:function(b){var d=c.defer();return this.getCustomer(b).then(function(b){a.get(f.person+"/"+b.person).then(function(c){var e=c.data,g="naturalPerson",h=e.natural_person;e.legal_person&&(g="legalPerson",h=e.legal_person),a.get(f[g]+"/"+h).then(function(a){var c=a.data;d.resolve({person:c,drivers:b.natural_persons})},function(a){d.reject(a)})},function(a){d.reject(a)})},function(a){d.reject(a)}),d.promise},saveCar:function(b){var d=h(),e=c.defer(),g=_.pick(b,["id","mileage","car_mark","car_model","car_modification","owner","manufacturing_date","vin_number","number_plate","engine_displacement","engine_power","cost","keys_count"]),i="post",j=f.customerCar;return g.owner=g.owner||d,g.id&&(i="put",j+="/"+g.id),a[i](j,g).then(function(d){var g=d.data,h=_.map(b.credential,function(a){return _.pick(a,["id","number","series","credential_type","issue_date","issue_point","expiration_date"])}),i=[];angular.forEach(h,function(b){var c="post",d=f.customerCar+"/"+g.id+"/credential";b.id&&(c="put",d+="/"+b.id),i.push(a[c](d,b).then(function(a){return a.data}))}),c.all(i).then(function(a){e.resolve({car:g,credential:a})},function(a){e.reject(a)})},function(a){e.reject(a)}),e.promise},createDeal:function(b){var d=c.defer();return a.post(f.deal,angular.extend({deal_status:1,customer:h()},b)).then(function(c){var e=c.data;e.car=b.car,a.put(f.deal+"/"+e.id,e).then(function(a){d.resolve(a.data)},function(a){d.reject(a)})},function(a){d.reject(a)}),d.promise},getDeal:function(b){return a.get(f.deal+"/"+b)},createInsuranceProduct:function(b,c){return a.post(f.deal+"/"+b+"/insurance-product/from-calculation",c).then(function(a){return a.data})},updateInsuranceProduct:function(b,c,d){return a.put(f.deal+"/"+b+"/insurance-product/"+c,d).then(function(a){return a.data})},createInvoice:function(b,c){return a.post(f.deal+"/"+b+"/insurance-product/"+c+"/invoice/generate").then(function(a){return a.data})},createPersonContainer:function(b,c){var d={};return c="legal_person"===c?"legal_person":"natural_person",d[c]=b,a.post(f.person,d).then(function(a){return a.data})},saveBSO:function(b,c){return a.post(f.resultPolicy+"/"+b+"/enter_bso/",c).then(function(a){return a.data})},createInsuredObjectByIds:function(b){return a.post("/rest/default/client/insured-object",b).then(function(a){return a.data})},createInsuredObjectOsago:function(a){var b={object:{car_mark:a.car.car_mark,car_model:a.car.car_model,car_model_group:a.car.car_model_group||null,car_modification:a.car.car_modification||null,cost:+a.car.cost,engine_displacement:a.car.engine_displacement,engine_power:a.car.engine_power,credential:a.car.credential,external_id:a.car.id||this.generateId(),vin_number:a.car.vin_number,number_plate:a.car.number_plate,manufacturing_date:a.car.manufacturing_date,keys_count:a.car.keys_count,mileage:a.car.mileage,car_body_number:a.car.car_body_number,engine_power_kilowatt:a.car.engine_power_kilowatt,chassis_number:a.car.chassis_number},object_type:"car",person:[],drivers:[]};return angular.forEach(b.object.credential,function(a){a.external_id=a.id||this.generateId()},this),angular.forEach(a.persons,function(a,c){var d,e,f={},g=[],h=a.id||this.generateId(),k=a.address_registration?[a.address_registration]:[],l=j(a),m=a.personType;k&&k.lendth&&(k[0].address_type=1),"natural_person"===m?(e=a.credential,angular.forEach(e,function(a){a&&(a.issue_date=i(a.issue_date),a.external_id=a.id||this.generateId())},this),!a.is_same_address&&a.address_residential&&(k.push(a.address_residential),k[1].content_type=482,k[1].address_type=2),a.birth_date=i(a.birth_date),a.driving_experience_started=i(a.driving_experience_started)):e=null,angular.forEach(["owner","insurant"],function(b){var c="is"+b[0].toUpperCase()+b.substr(1);a[c]&&g.push(b)}),g.length>0&&(f.role=g,f.external_id=h,f.id=a.person_id,f[m]=l,f[m].external_id=h,f[m].credential=e,f[m].address=k,b.person.push(f)),a.isDriver&&(d=angular.copy(l),d.external_id=h,d.credential=[],d.credential.push(_.find(e,function(a){return 3===a.credential_type})),d.credential.push(_.find(e,function(a){return 1===a.credential_type})),d.credential[1]||(d.credential.length=1),b.drivers.push(d))},this),g.post(f.insuredObjectOsago,b).then(function(a){return m=angular.copy(a.data),a.data})},sendPhone:function(b){return a.post("/policy/rest/result_policy/"+b.policy_id+"/token",_.pick(b,"phone")).then(function(a){return a.data})},confirmPhone:function(b){return a.post("/policy/rest/result_policy/"+b.policy_id+"/token-verified",_.pick(b,"token")).then(function(a){return a.data})},toPay:function(b){return a.post("/payment/"+b+"/ ").then(function(a){return a.data})},createInsuredObject:function(a){var b,c;return a.car?(b={object:{car_mark:a.car.car_mark,car_model:a.car.car_model,car_model_group:a.car.car_model_group||null,car_modification:a.car.car_modification||null,cost:a.car.cost,engine_displacement:a.car.engine_displacement,engine_power:a.car.engine_power,credential:a.car.credential,external_id:a.car.id||this.generateId(),vin_number:a.car.vin_number,number_plate:a.car.number_plate,manufacturing_date:a.car.manufacturing_date,keys_count:a.car.keys_count,mileage:a.car.mileage,is_new_car:a.car.is_new_car,is_temporary:a.car.is_temporary,chassis_number:a.car.chassis_number},object_type:"car",person:[],drivers:[]},c=["owner","insurant","beneficiary"],angular.forEach(b.object.credential,function(a){a.external_id=a.id||this.generateId()},this)):(b=k,c=["owner","insurant"]),angular.forEach(a.persons,function(a,d){var e,f,g={},h=[],k=a.id||this.generateId(),l=[a.address_registration],m=_.filter(a.contact,function(a){return a.data}),n=j(a),o=a.personType;"legal_person"===o?f=null:(f=a.credential,angular.forEach(f,function(a){a.issue_date=i(a.issue_date),a.external_id=a.id||this.generateId()},this),a.is_same_address||l.push(a.address_residential),a.is_temporary_registration&&l.push(a.address_temporary_registration),a.birth_date=i(new Date(a.birth_date)),a.driving_experience_started=a.driving_experience_started?i(new Date(a.driving_experience_started)):null),angular.forEach(c,function(b){var c="is"+b[0].toUpperCase()+b.substr(1);a[c]&&h.push(b)}),angular.forEach(l,function(a){a&&!a.country&&(a.country="Россия")}),h.length>0&&(g.role=h,g.external_id=k,g.id=a.person_id,g[o]=n,g[o].external_id=k,g[o].contact=m,g[o].credential=f,g[o].address=l,b.person.push(g)),a.isDriver&&(e=angular.copy(n),e.external_id=k,e.address=l,e.credential=_.filter(f,function(a){return 3===a.credential_type}),b.drivers.push(e))},this),g.post(f.insuredObject,b).then(function(a){return m=angular.copy(a.data),a.data})},getInsuredObject:function(a){return g.get(f.insuredObject+"/"+a).then(function(a){return m=angular.copy(a.data),a.data})},getInsuredObjectOsago:function(a){return g.get(f.insuredObjectOsago+"/"+a).then(function(a){return m=angular.copy(a.data),a.data})},getPolicyFile:function(b,c){return c=c?"?type="+c:"",a({method:"GET",url:f.resultPolicy+b+"/template/"+c,headers:{}}).then(function(a){return a.data})},createInsuredObjectCRM:function(b){return a.post(f.insuredObjectCRM,b).then(function(a){return a.data})},createPolicy:function(b){return a.post(f.resultPolicy,angular.extend({external_id:h()},b)).then(function(a){return l=a.data})},savePolicy:function(b){var c="post",d=f.resultPolicy;return b.id&&(c="put",d=f.resultPolicy+b.id+"/"),a[c](d,angular.extend({external_id:h()},b)).then(function(a){return l=a.data})},getPolicy:function(b){return a.get(f.resultPolicy+b+"/",{params:{external_id:h()}}).then(function(a){return l=a.data})},getSavedNaturalPersons:function(b){return a.get(f.savedNaturalPersons,{params:b}).then(function(a){return a.data})},getSavedLegalPersons:function(b){return a.get(f.savedLegalPersons,{params:b}).then(function(a){return a.data})},getSavedCars:function(b){return a.get(f.savedCars,{params:b}).then(function(a){return a.data})},getInsObjList:function(b){return a.get(f.insuredObectList,{params:b}).then(function(a){return console.log(a),a.data})},getCurrentPolicy:function(){return l},getCurrentInsuredObject:function(){return m},sendNotification:function(b){return a.post(f.notificationSend,b).then(function(a){return a.data})},generateId:function(){return~~(9900*Math.random()+100)},getPolicyActionsParameters:function(b){return a.get(f.resultPolicy+b+"/actions_parameters/",{params:{external_id:h()}}).then(function(a){return a.data})},executePolicyAction:function(c,d,e){return a.post(b.urlPrefixPolicy+"result_policy/"+c+"/"+d+"/",e).then(function(a){return a.data})},getPolicyDocsArchive:function(c){return a.get(b.urlPrefixPolicy+"result_policy/"+c+"/zip/").then(function(a){return a.data})},getPolicyAttachments:function(b){return a.get(f.resultPolicy+b+"/attachment/").then(function(a){return a.data})},deletePolicyAttachment:function(b,c){return a["delete"](f.resultPolicy+b+"/attachment/"+c).then(function(a){return a.data})},issueToSavedPolicy:function(b){return a.post(f.resultPolicy+b+"/issue_to_saved_policy/").then(function(a){return a})},setPersonValidationDates:function(a){a.isDriver?(a.birthDateRange={min:function(){var b=new Date;return b.setFullYear(b.getFullYear()-a.age-1),i(b)}(),max:function(){var b=new Date;return b.setFullYear(b.getFullYear()-a.age),i(b)}()},a.expirienceRange={min:function(){var b=new Date;return b.setFullYear(b.getFullYear()-a.expirience-1),i(b)}(),max:function(){var b=new Date;return b.setFullYear(b.getFullYear()-a.expirience),i(b)}()}):(a.birthDateRange={min:function(){var a=new Date;return a.setFullYear(a.getFullYear()-90),i(a)}(),max:function(){var a=new Date;return a.setFullYear(a.getFullYear()-18),i(a)}()},a.expirienceRange={min:function(){var a=new Date;return a.setFullYear(a.getFullYear()-72),i(a)}(),max:function(){return i(new Date)}()}),a.birthDateRange.yearRange=new Date(a.birthDateRange.min).getFullYear()+":"+new Date(a.birthDateRange.max).getFullYear(),a.expirienceRange.yearRange=new Date(a.expirienceRange.min).getFullYear()+":"+new Date(a.expirienceRange.max).getFullYear(),a.dateChanged=function(b,c){var d=new Date(b).getFullYear(),e=new Date(c).getFullYear();a.invalidDates=d-e>=18}}};return n}])}(angular),function(angular,a){"use strict";angular.module("formationPolicyC").service("formationPolicyStep1Service",["$filter","$rootScope","formationPolicyService","Person","calculatorService","$q",function(a,b,c,d,e,f){function g(){return w=angular.copy(H)}function h(a,b){b=b||w;var c=_.filter(a,function(a){return a.credential_type===E.credential_type}),d=_.filter(a,function(a){return a.credential_type===F.credential_type});b.vehicle_registration=_.maxBy(c,function(a){return a.id})||angular.copy(E),b.vehicle_certificate=_.maxBy(d,function(a){return a.id})||angular.copy(F)}function i(a){if(_.head(a.credential)&&"natural_person"===a.personType){var b=_.filter(a.credential,function(a){return a.credential_type==D.credential_type}),c=_.filter(a.credential,function(a){return a.credential_type==C.credential_type});a.driver_license=_.maxBy(b,function(a){return a.id}),a.passport=_.maxBy(c,function(a){return a.id})||angular.copy(C)}return a}function j(a){return angular.isArray(a.contact)&&a.contact.length>0&&(a.contact=_.sortBy(_.uniqBy(a.contact,function(a){return a.contact_type}),function(a){return a.contact_type})),a}function k(a){var b=new Date,c=new Date(a);if(c.getTime())return new Date(b-c).getFullYear()-1970}function l(a){a.full=a.city+", "+a.street+", д."+a.house}function m(a){if(angular.isArray(a.address)&&a.address.length>0){var b=_.filter(a.address,function(a){return 1===a.address_type});b=_.maxBy(b,function(a){return a.id});var c=_.filter(a.address,function(a){return 2===a.address_type});c=_.maxBy(c,function(a){return a.id});var d=_.filter(a.address,function(a){return 3===a.address_type});d=_.maxBy(d,function(a){return a.id}),a.is_same_address=!c,a.is_temporary_registration=Boolean(d),b&&(a.address_registration=b,l(b)),c&&(a.address_residential=c,l(c)),d&&(a.address_temporary_registration=d,l(d))}return a}function n(a,c){return c=c||b.calcType,K[c](a,w)}function o(a){return a=a||b.calcType,J[a]()}function p(a,c,d,e){return e=e||b.calcType,I[e](a,c,d)}function q(a,c){return c=c||b.calcType,L[c](a,c)}function r(a){return O.allTypes(a)}function s(a){return a=a||b.calcType,M[a]()}function t(a){return N.allTypes(a)}function u(){x.length=0,g()}function v(a){return a=a||b.calcType,P[a](a)}var w,x=[],y=e.calculation,z="yyyy-MM-dd",A=function(b){return a("date")(b,z)},B={address_type:1,postal_index:null,content_type:482,country:"Россия",city:"",street:"",house:"",housing:"",flat:"",kladr:""},C={credential_type:1,series:"",number:"",issue_date:"",issue_point:"",expiration_date:""},D={credential_type:3,series:"",number:"",issue_date:"",issue_point:"РФ",expiration_date:""},E={credential_type:4,series:"",number:"",issue_date:"",issue_point:"",expiration_date:""},F={credential_type:7,series:"",number:"",issue_date:"",issue_point:"",expiration_date:""},G={is_same_address:!0,person_type:"natural_person",credential:[],isOwner:!1,isDriver:!1,isInsurant:!1,first_name:"",last_name:"",patronymic:"",gender:null,birth_date:"",passport:angular.copy(C),address_registration:angular.copy(B),address_residential:angular.extend(angular.copy(B),{address_type:2})},H={car_mark:null,car_model:null,car_modification:null,cost:0,vin_number:"",chassis_number:"",number_plate:"",engine_displacement:"",engine_power:"",engine_power_kilowatt:"",keys_count:y.driver_set.length||1,mileage:"",manufacturing_date:null,selectedCar:"",vehicle_registration:angular.copy(E),vehicle_certificate:angular.copy(F),document_issue_date:"",mode:"edit"};g();var I={osago:function(a,b,e){var f,g=new Date,h=18,i=new d(angular.extend(angular.copy(G),{personType:b||"natural_person",isOwner:!1,isInsurant:!1,isDriver:!1,selectedPerson:"",mode:"edit"}));return a=a||{},"legal_person"===b?(i.extend({title:"",isDriver:!1,inn:"",ogrn:""}),i.address_registration=i.addAddress(angular.copy(B))):(f=a.expirience||0===a.expirience?a.expirience:null,null===f&&(f=k(a.driving_experience_started)),i.extend({age:a.age||h,expirience:f,gender:"M",birth_date:a.birth_date||"",is_same_address:!0,is_temporary_registration:!1,driving_experience_started:a.driving_experience_started||""}),i.passport=i.addCredential(angular.copy(C)),i.driver_license=i.addCredential(angular.copy(D)),i.address_registration=i.addAddress(angular.copy(B)),i.address_residential=i.addAddress(angular.copy(B)),i.address_temporary_registration=i.addAddress(angular.copy(B)),i.driving_experience_started||(g=new Date,g.setFullYear(g.getFullYear()-i.expirience),i.driver_license.issue_date=A(g),i.driving_experience_started=A(g))),i.extend(a),c.setPersonValidationDates(i),i.hasRole=function(){return i.isInsurant||i.isOwner},e||x.push(i),i}},J={osago:function(){function a(){return y.id||(y.insured_object=11920),y.insured_object?c.getInsuredObject(y.insured_object):f.when({})}return a().then(function(a){a&&a.id?n(a):_.forEach(y.driver_set,function(a){var b={isDriver:!0,showFioFields:!0};p(angular.extend(b,a))}),angular.extend(w,{car_mark:y.car_mark,car_model:y.car_model,car_modification:y.car_modification,cost:Math.floor(y.car_cost),car_body_number:"",vin_number:null,number_plate:"",engine_displacement:null,engine_power:y.engine_power,mileage:null,manufacturing_date:y.car_manufacturing_year+"-01-01",vehicle_registration:angular.copy(E),vehicle_certificate:angular.copy(F),credential:[]}),angular.extend(w,a.object),w.id=null;var c=_.head(x);if(y.is_legal_entity&&"false"!==y.is_legal_entity&&(c.address_registration=angular.copy(B)),y.is_legal_entity&&b.currentUser){c.isInsurant=!1;var d=p({isInsurant:!0,isOwner:!1,isDriver:!1,title:b.currentUser.last_name,inn:b.currentUser.inn,ogrn:b.currentUser.ogrn},"legal_person");b.currentUser.address&&(angular.extend(d.address_registration,b.currentUser.address),l(d.address_registration))}else c&&b.currentUser&&b.currentUser.id&&(c.passport&&!c.passport.series&&(c.passport.series=b.currentUser.passport_series,c.passport.number=b.currentUser.passport_number),c.address_registration&&!c.address_registration.city&&b.currentUser.address&&(angular.extend(c.address_registration,b.currentUser.address),l(c.address_registration))),c.isInsurant=!0;c.isOwner=!0})}},K={osago:function(b){var c;x.length=0,w=b.object,h(w.credential),w.engine_power_kilowatt=+(.7355*y.engine_power).toFixed(2),w.engine_power=y.engine_power,_.forEach(b.person,function(b){var c=b.natural_person?"natural_person":"legal_person";b[c].personType=c,b[c].person=b.id,i(b[c]),m(b[c]),b[c].selectedPerson=b[c].external_id,"natural_person"===c&&(b[c].age=a("calcAge")(b[c].birth_date)),b.role.length&&_.forEach(b.role,function(a){b[c]["is"+a[0].toUpperCase()+a.substr(1)]=!0}),p(b[c])}),c=_.forEach(b.drivers,function(a){a.personType="natural_person",a.isDriver=!0,i(a),m(a)}),_.forEach(c,function(a){var b;_.forEach(x,function(c,d){a.external_id===c.external_id&&(b=!0,angular.extend(c,a),c.isDriver=!0)}),a.driver_license=_.find(a.credential,function(a){return 3===a.credential_type})||angular.copy(D),b||p(a)})}},L={osago:function(a){var b=x.indexOf(a),c=b-1>=0?b-1:b+1;a.isOwner&&(x[c].isOwner=!0),a.isInsurant&&(x[c].isInsurant=!0),b!==-1&&x.splice(b,1)}},M={osago:function(){angular.forEach(x,function(a){a.address=[],a.credential=[],a.birth_date=A(a.birth_date),"natural_person"===a.personType&&((a.isInsurant||a.isOwner)&&(a.passport.credential_type=1,a.credential.push(a.passport)),a.isDriver&&(a.driver_license&&a.credential.push(a.driver_license),a.driving_experience_started=A(a.driving_experience_started)))});var a=_.find(x,function(a){return a.isOwner}),b=_.find(x,function(a){return a.isInsurant}),d=_.map(_.filter(x,function(a){return a.isDriver}),"id"),e={owner:a.person,beneficiary:a.person,insurant:b.person,drivers:d,object_type:"car",object_id:w.id};return w.credential=[],w.vehicle_registration&&w.credential.push(w.vehicle_registration),w.vehicle_certificate&&w.credential.push(w.vehicle_certificate),c.createInsuredObjectByIds(e)}},N={allTypes:function(a){return function(b){return angular.isObject(b)&&(r(a),a.extend(b),a.getCredentialList().then(function(){i(a)}),a.getAddressList().then(function(){m(a)}),a.getContactList().then(function(){j(a)})),!0}}},O={allTypes:function(a){return angular.extend(a,{id:null,age:a.selectedPerson?18:a.age,birth_date:"",last_name:"",first_name:"",patronymic:"",last_name_eng:"",first_name_eng:"",patronymic_eng:"",is_same_address:!0,driving_experience_started:"",selectedPerson:"",document:{credential_type:1,series:"Не указан",number:"",issue_date:""},title:"",title_eng:"",inn:"",ogrn:"",kpp:"",representative_first_name:"",representative_last_name:"",representative_patronymic:"",representative_post:"",representative_credential_type:"",representative_number:"",representative_issue_date:"",rsa_check_id:null,person:null,is_verified:null,is_current_user:!1}),a.pT=a.pT||a.personType,a.passport=a.addCredential(angular.copy(C)),a.ogrntip=a.addCredential(angular.copy(C)),a.driver_license=a.addCredential(angular.copy(D)),a.address_registration=a.addAddress(angular.copy(B)),a.address_residential=a.addAddress(angular.copy(B)),a.address_temporary_registration=a.addAddress(angular.copy(B)),a.contact=[{contact_type:1,data:""},{contact_type:2,data:""}],a.address_registration.country=null,a.address_residential.country=null,a.address_temporary_registration.country=null,a.credential.length=0,a.address.length=0,a.contact.length=0,a}},P={osago:function(){var a={isInsurant:!1,isOwner:!1,all:!1};return _.forEach(x,function(b){b.isInsurant&&(a.isInsurant=!0),b.isOwner&&(a.isOwner=!0)}),a.all=a.isInsurant&&a.isOwner,a}};return{addPerson:p,resetPerson:r,initFromCalculation:o,initFromInsuredObject:n,removePerson:q,persons:x,getPersons:function(){return x},createInsuredObject:s,resetAll:u,showSavedPersonsCallback:t,resetCar:g,getCar:function(){return w},setCarCredentials:h,getDefaultObject:function(a){var b={defaultAddressObject:B,defaultPassportObject:C,defaultDriverLicenseObject:D,defaultVehicleRegistrationObject:E};return angular.copy(b[a])},setPersonCredential:i,setPersonAddress:m,setFullAddress:l,personCheckUsed:v}}])}(angular,jQueryApp),function(angular){angular.module("dropdown",[])}(angular),function(angular,a){"use strict";angular.module("dropdown").constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document",function(a){var b=null;this.open=function(e){b||(a.bind("click",c),a.bind("keydown",d)),b&&b!==e&&(b.isOpen=!1),b=e},this.close=function(e){b===e&&(b=null,a.unbind("click",c),a.unbind("keydown",d))};var c=function(a){if(b){var c=b.getToggleElement();a&&c&&c[0].contains(a.target)||b.$apply(function(){b.isOpen=!1})}},d=function(a){27===a.which&&(b.focusToggleElement(),c())}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate",function(a,b,c,d,e,f){var g,h=this,i=a.$new(),j=d.openClass,k=angular.noop,l=b.onToggle?c(b.onToggle):angular.noop;this.init=function(d){h.$element=d,b.isOpen&&(g=c(b.isOpen),k=g.assign,a.$watch(g,function(a){i.isOpen=!!a}))},this.toggle=function(a){return i.isOpen=arguments.length?!!a:!i.isOpen,i.isOpen},this.isOpen=function(){return i.isOpen},i.getToggleElement=function(){return h.toggleElement},i.focusToggleElement=function(){h.toggleElement&&h.toggleElement[0].focus()},i.$watch("isOpen",function(b,c){f[b?"addClass":"removeClass"](h.$element,j),b?(i.focusToggleElement(),e.open(i)):e.close(i),k(a,b),angular.isDefined(b)&&b!==c&&l(a,{open:!!b})}),a.$on("$locationChangeSuccess",function(){i.isOpen=!1}),a.$on("$destroy",function(){i.$destroy()})}]).directive("dropdown",function(){return{controller:"DropdownController",link:function(a,b,c,d){d.init(b)}}}).directive("dropdownToggle",function(){return{require:"?^dropdown",link:function(a,b,c,d){if(d){d.toggleElement=b;var e=function(e){e.preventDefault(),b.hasClass("disabled")||c.disabled||a.$apply(function(){d.toggle()})};b.bind("click",e),b.attr({"aria-haspopup":!0,"aria-expanded":!1}),a.$watch(d.isOpen,function(a){b.attr("aria-expanded",!!a)}),a.$on("$destroy",function(){b.unbind("click",e)})}}}})}(angular,jQueryApp),function(angular){angular.module("UIElements",[])}(angular),function(angular,a){"use strict";angular.module("UIElements").directive("inputSlider",["$filter",function(b){function c(c,d,e,f){function g(a){l.slider({min:k?0:p,max:k||q,step:o,slide:function(b,c){a?f.$setViewValue(a[c.value].id):f.$setViewValue(Math.floor(c.value/o)*o)},create:function(){i(p,q),f.$viewValue&&h(f.$viewValue)}})}function h(a){r?r.then(function(b){a="null"===a?null:a,_.find(b,function(b,c){if(b.id==a)return l.slider("option","value",c),!0})}):l.slider("option","value",a)}function i(a,c){r||(l.slider("option","min",a),l.slider("option","max",c)),e.isSum&&(a=b("priceFormatter")(a),c=b("priceFormatter")(c)),m.text(a),n.text(c),l.removeClass("hidden")}function j(){p&&q?i(p,q):l.addClass("hidden")}var k,l=a(d),m=l.find(".js-slider-min"),n=l.find(".js-slider-max"),o=e.sliderStep?e.sliderStep>>0:1e3,p=e.defaultMin?e.defaultMin>>0:0,q=e.defaultMax?e.defaultMax>>0:1e6,r=e.slideItems?c.$eval(e.slideItems):null;l.addClass("b-input-slider"),_.isPromise(r)?(l.addClass("b-input-slider__range"),r.then(function(a){p=_.head(a).title,q=_.last(a).title,k=a.length-1,o=1,g(a)})):g(),c.$watch(function(){return c.$eval(e.inputSlider)},function(a,b){a&&!angular.equals(a,b)&&(l.slider("option","value",a.sum),a.maxSum&&a.minSum?(l.slider("option","min",a.minSum),l.slider("option","max",a.maxSum),i(a.minSum,a.maxSum)):j())},!0),c.$watch(function(){return f.$viewValue},function(a,b){h(a)})}return{restrict:"EA",require:"ngModel",link:c,scope:!1,template:'<div class="b-input-slider_range"><span class="b-input-slider_min js-slider-min"></span><span class="b-input-slider_max js-slider-max"></span></div>'}}])}(angular,jQueryApp),function(angular,a){"use strict";angular.module("UIElements").directive("semCheckbox",["$compile",function(b){var c=100;return{restrict:"EA",require:"ngModel",replace:!0,scope:!1,template:'<div class="ui checkbox"><input type="checkbox" tabindex="0" class="hidden sem-checkbox"><label></label></div>',compile:function(d,e,f){var g,h=a(d),i=h.find(".sem-checkbox"),j=h.find("label"),k=e.semId,l="sem-id-"+c++;return h.removeAttr("sem-checkbox"),angular.forEach(e.$attr,function(a,b){["class","semType","style"].indexOf(b)===-1?(i.attr(a,e[b]),
h.removeAttr(a)):e[b]&&h.addClass(e[b])}),"radio"===e.semType&&i.attr("type","radio"),k?(j.attr("for",k),i.attr("id",k)):(j.attr("for",l),i.attr("id",l)),j.html(e.semLabel),g=b(h),{pre:function(a){g(a)}}}}}])}(angular,jQueryApp),function(angular,a){"use strict";angular.module("UIElements").directive("semDropdown",["$timeout","$q",function(b,c){return{restrict:"EA",require:"^ngModel",replace:!0,template:'<div><input type="hidden"><i class="dropdown icon"></i><div class="text"><span ng-bind="placeholder"></span></div><div class="menu"></div></div>',scope:{items:"=semDropdownItems",placeholder:"@semDropdownPlaceholder"},link:function(b,d,e,f){function g(a){n.empty(),!b.placeholder||o||p||n.append(j({id:"",title:b.placeholder})),angular.forEach(a,function(a){var b={id:a.id,title:a.title,item_type:a.item_type};q&&(b={id:a,title:a}),n.append(j(b))}),a&&a.length||k.addClass("disabled js-was-empty")}function h(a,b){function c(b){var c,d=_.find(b,function(b){var c=q?b:b.id;return c==a});return c=d?q?d:d.id:null,i(c),c}return b?c(b):l.promise.then(c)}function i(a){var b;b=angular.isArray(a)?_.map(a,function(a){return a+""}):void 0==a?"":a+"",k.dropdown("set selected",b)}function j(a){var b=a.item_type||"item";return'<div class="'+b+'" data-value="'+a.id+'"><span>'+a.title+"</span></div>"}var k=a(d),l=c.defer(),m=[],n=k.find(".menu"),o=k.hasClass("multiple"),p=k.hasClass("placeholder-is-not-item"),q=!!e.semDropdownSimple;b.items||console.log("У этого элемента нет поля items ",d[0]),b.items&&(_.isPromise(b.items)?b.items.then(l.resolve):_.isArray(b.items)?l.resolve(b.items):_.isFunction(b.items)&&b.items().then(function(a){return m=a,l.resolve(m.items),b.$watch(function(){return m.changingCondition()},function(a,b){var c,d;if(!angular.equals(a,b))return c=m.items,m.action({items:c},a),d=c&&c[0]&&c[0].id,g(c),k.dropdown("refresh"),d&&k.hasClass("js-was-empty")&&(k.removeClass("disabled"),h(f.$viewValue)),"null"!==e.semDropdownDefaultValue&&d?h(f.$viewValue,c)||i(d):void i(null)},!0),a})),k.hasClass("selection")||k.find(".icon.dropdown").remove(),l.promise.then(function(a){g(a),k.dropdown({selectOnKeydown:!1,fullTextSearch:!0,forceSelection:!1,match:"text",onChange:function(a){var b=a;"false"!==a&&"true"!==a||(b=JSON.parse(a)),f.$setViewValue(b)},message:{addResult:"Добавить <b>{term}</b>",count:"{count} выбрано",maxSelections:"Доступно {maxCount}",noResults:"Совпадений не найдено."},className:{label:"ui red label"},action:e.semDropdownAction}),i(f.$viewValue)}),b.items&&(angular.isFunction(b.items)||angular.isFunction(b.items.then))||b.$watch("items",function(a,b){a&&a.length&&(1!==l.promise.$$state.status?l.resolve(a):g(a),k.hasClass("js-was-empty")&&(k.removeClass("disabled"),h(f.$viewValue)))},!0),b.$watch(function(){return f.$viewValue},function(a,b){var c=k.dropdown("get value");a==c&&!_.isBoolean(a)&&!_.isNumber(a)||angular.equals(a,c)||(void 0==a||o?i(f.$viewValue):h(a))})}}}])}(angular,jQueryApp),function(angular,a){"use strict";angular.module("UIElements").directive("semErrorLabel",["errorLabelProvider",function(b){function c(c,d,e){function f(a){i.text(a.title),a["class"]&&i.addClass(a["class"]),i.addClass("sem-error-label")}var g,h,i=a(d),j=e.labelNamespace;if(!j)throw new Error("Не задана область видимости");g=function(){var a=i.siblings("input"),b="attr";return a.length||(a=i.siblings(".ui.input").find("input").eq(0),a.length||(a=i.siblings(".dropdown"),b="data",a.length||(a=i.siblings(".js-label-target")))),a[b]("name")}(),h=b.getLabel(j,g),f(h)}return{restrict:"EA",link:c,replace:!0,template:'<div class="ui top pointing basic label"></div>'}}])}(angular,jQueryApp),function(angular,a){"use strict";angular.module("UIElements").directive("semPopup",[function(){return{restrict:"EA",scope:{content:"@semPopupContent",title:"@semPopupTitle",variation:"@semPopupVariation",position:"@semPopupPosition"},compile:function(){return{pre:function(b,c,d,e){var f=a(c),g={content:b.content,title:b.title,variation:b.variation,position:b.position?b.position:"top center"};"UNPUT"===c.tagName&&(g.on="focus"),f.popup(g)}}}}}])}(angular,jQueryApp),function(angular){"use strict";angular.module("UIElements").provider("errorLabelProvider",[function(){var a={title:"Поле не заполнено"},b={fps1:{first_name:{title:"Имя не заполнено"},last_name:{title:"Фамилия не заполнена"},citizenship:{title:"Гражданство не выбрано"},person_document_issue_date:{title:"Дата выдачи документа не заполнена"},document:{title:"Тип документа не выбран"},address_registration:{title:"Не все обязательные поля адреса заполнены"},person_phone:{title:"Телефон не заполнен"}}};this.$get=function(){return{getLabel:function(c,d){return d&&b[c][d]||a}}}}])}(angular),function(angular){angular.module("carFilterC",[])}(angular),function(angular){"use strict";angular.module("carFilterC").controller("carFilterCtrl",["$scope","Dictionary","$rootScope","calculatorService","calculatorStepsService","CONSTS","$http",function(a,b,c,d,e,f,g){function h(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}function i(){var b=(new Date).getFullYear()-a.calculation.car_manufacturing_year;a.carFilterParams.mileage=a.carFilterParams.mileage||2e4*b}function j(){return{age:26,expirience:8,is_married:!1,has_children:!1,gender:"M"}}function k(){a.calculation.drivers_minimal_age=null,a.calculation.drivers_minimal_experience=null}function l(b){b&&(a.carFilterParams.antitheft=b.id,a.carFilterParams.antitheft_title=b.as_mark.title+" - "+b.title)}function m(b){b&&(a.carFilterParams.exploitation_area=b.id,a.carFilterParams.exploitation_area_title=b.title)}function n(b){1===b&&(a.modelCarModel=null,a.calculation.car_model=null,a.allSelected.carModel=null,a.modelCarModelGroup=null,a.allSelected.carModelGroup=null,a.calculation.car_model_group=null,a.modelCarMark=null,a.calculation.car_mark=null,a.allSelected.carMark=null),2===b&&(a.modelCarModel=null,a.calculation.car_model=null,a.allSelected.carModel=null,a.modelCarModelGroup=null,a.allSelected.carModelGroup=null,a.calculation.car_model_group=null),3===a.carFilterStep&&(a.modelCarModel=null,a.calculation.car_model=null,a.allSelected.carModel=null)}var o=new Date,p=c.currentBrand;a.calculatorParams=d.calculatorOtherParams,a.carFilterStep=1,a.selectedCar={},a.calculation=d.calculation,console.log(a.calculation.id),a.carFilterTemplates={first_big_step:f.pathToModules+"carFilterC/views/first_big_step.html",second_big_step:f.pathToModules+"carFilterC/views/second_big_step.html",third_big_step:f.pathToModules+"carFilterC/views/third_big_step.html",fourth_big_step:f.pathToModules+"carFilterC/views/fourth_big_step.html"},a.clientParams={client_name:"",client_phone:"",sms_is_visible:!1,client_params_are_disabled:!1},a.showSMSform=function(){a.clientParams.client_params_are_disabled=!0,a.calculatorParams.send_sms_text=!0,a.calculation.client_name=a.clientParams.client_name,a.calculation.client_phone=a.clientParams.client_phone,g({url:f.proxyPathC+"smsc/sendcode.php",method:"POST",transformRequest:h,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:{phone_no:a.clientParams.client_phone}}).then(function(b){_.isString(b.data)&&/(отправлен)/.test(b.data)&&(a.clientParams.sms_is_visible=!0),a.clientParams.client_params_are_disabled=!1})},a.calculateKaskoCarFilter=function(){a.$parent.calculateKasko()},a.confirmCode=function(){a.clientParams.sms_button_is_disabled=!0,a.calculatorParams.confirm_code_is_incorrect=!1,g({url:f.proxyPathC+"smsc/verify.php",method:"POST",transformRequest:h,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:{code:a.clientParams.sms_code}}).then(function(b){_.isString(b.data)&&/(Код проверки верный)/.test(b.data)?a.calculatorParams.resultsAreVisible=!0:a.calculatorParams.confirm_code_is_incorrect=!0,a.clientParams.sms_button_is_disabled=!1})},a.driversChanging=[{id:1,title:"1 водитель"},{id:2,title:"2 водителя"},{id:3,title:"3 водителя"},{id:4,title:"4 водителя"},{id:0,title:"Без ограничений"}],a.bigSteps=e.bigSteps,a.mainRegions=[],a.carFilterParams={lastDriverIndex:0,engine_power:a.calculation.engine_power||120,ownerRegistrationViewIsFull:!1,exploitation_area:a.calculation.exploitation_area||null,calculation_type:e.calculation_type,car_cost:a.calculation.car_cost||null,drivers:a.calculation.driver_set.length?a.calculation.driver_set:[],drivers_count:null,drivers_minimal_age:18,drivers_minimal_experience:0,is_earlier_insurance:null,antitheft:null,is_credit:null,contributory_scheme:null,currentDriverIndex:0,mileage:a.calculation.mileage||null,selectedResult:function(){return d.getSelectedResult()},was_clicked:!1,exploitation_area_all_are_hidden:p.exploitation_area_all_are_hidden},a.calcTypes=[{id:"simple",title:"Примерный"},{id:"full",title:"Точный (с данными КБМ водителей)"}],a.onKeypressDecorator=function(a,b){if(13==a.keyCode&&"function"==typeof b)return b},a.setCalculationType=function(b){e.calculation_type=b,a.carFilterParams.calculation_type=b},e.getCurrentCalcType=function(){return a.carFilterParams.calculation_type},a.goNextDriver=function(b){var d=b+1;return a.carFilterParams.driverIsEditing?(a.carFilterParams.currentDriverIndex=a.carFilterParams.lastDriverIndex,void(a.carFilterParams.driverIsEditing=!1)):(a.calculation.driver_set[b]=a.carFilterParams.drivers[b],void(a.carFilterParams.drivers_count&&a.carFilterParams.drivers_count.id===d?(a.setActiveStepSecond("is_credit"),c.currentBrand.with_sms||(a.calculateKaskoCarFilter(),a.calculatorParams.resultsAreVisible=!0)):(a.carFilterParams.currentDriverIndex=d,a.carFilterParams.lastDriverIndex=d)))},a.toEditDriver=function(b){var c=a.carFilterParams.currentDriverIndex;a.carFilterParams.currentDriverIndex=b,a.carFilterParams.driverIsEditing=!0,a.carFilterParams.lastDriverIndex=c},a.removeDriver=function(b){a.calculation.driver_set.splice(b,1),a.carFilterParams.drivers.splice(b,1),a.calculation.drivers_count=a.calculation.driver_set.length,a.carFilterParams.drivers_count=_.find(a.driversChanging,function(b){return b.id===a.carFilterParams.drivers.length}),a.calculation.driver_set.length&&"drivers"===e.getActiveStepSecond().name?a.carFilterParams.currentDriverIndex=a.carFilterParams.currentDriverIndex-1:e.setActiveStepSecond("drivers_count")},a.getActiveButtonClass=function(a){return a&&"active"||""},a.changeDriversCount=function(b){a.carFilterParams.drivers_count=b,a.calculation.drivers_count=b.id,a.carFilterParams.drivers.length=0,a.calculation.driver_set.length=0,b.id?(_.times(b.id,function(){a.carFilterParams.drivers.push(j())}),e.setActiveStepSecond("drivers"),a.carFilterParams.currentDriverIndex=0):e.setActiveStepSecond("multidrive")},a.multidriveNext=function(){a.calculation.drivers_minimal_age=a.carFilterParams.drivers_minimal_age,a.calculation.drivers_minimal_experience=a.carFilterParams.drivers_minimal_experience,a.calculation.is_multidrive=!0,a.setActiveStepSecond("is_credit")},a.antitheftNext=function(){a.calculation.antitheft=a.carFilterParams.antitheft,a.bigSteps.setBigStep("third")},a.isCreditNext=function(){a.calculation.is_credit=a.carFilterParams.is_credit,a.bigSteps.setBigStep("third")},a.enginePowerNext=function(){a.calculation.engine_power=a.carFilterParams.engine_power,a.setActiveStep("exploitation_area")},a.ownerRegistrationNext=function(){a.calculation.exploitation_area=a.carFilterParams.exploitation_area,a.setActiveStep("car_cost")},a.carCostNext=function(){a.calculation.car_cost=a.carFilterParams.car_cost,a.bigSteps.setBigStep("second")},a.mileageNext=function(){a.calculation.mileage=(a.carFilterParams.mileage||0)+"",a.bigSteps.setBigStep("second")},a.activeStep={},a.getActiveStep=function(){return a.activeStep=e.getActiveStep(),a.activeStep},a.getActiveStepSecond=function(){return a.activeStepSecond=e.getActiveStepSecond(),a.activeStepSecond},a.setActiveStep=function(b){"year"===b&&(a.calculation.engine_power=null,a.calculation.exploitation_area=null,a.calculation.car_cost=null,a.calculation.mileage=null,a.setCarFilterStep(1),n(1)),"car"===b&&(a.calculation.engine_power=null,a.calculation.exploitation_area=null,a.calculation.car_cost=null,a.calculation.mileage=null),"engine_power"===b&&(a.calculation.engine_power=null,a.calculation.exploitation_area=null,a.calculation.car_cost=null,a.calculation.mileage=null),"exploitation_area"===b&&(a.calculation.exploitation_area=null,a.calculation.car_cost=null,a.calculation.mileage=null),"car_cost"===b&&(a.calculation.car_cost=null,a.calculation.mileage=null),"mileage"===b&&(a.calculation.mileage=null),e.setActiveStep(b)},a.setActiveStepSecond=function(b){"drivers_count"===b&&(a.calculation.drivers_count=null,a.calculation.is_multidrive=!1,a.calculation.is_earlier_insurance=null,a.calculation.is_credit=null,a.calculation.contributory_scheme=null,k()),"multidrive"===b&&(k(),a.carFilterParams.lastDriverIndex=0,a.calculation.is_earlier_insurance=null,a.calculation.is_credit=null,a.calculation.contributory_scheme=null),"is_earlier_insurance"===b&&(a.calculation.is_earlier_insurance=null,a.calculation.is_credit=null,a.calculation.contributory_scheme=null),"is_credit"===b&&(a.calculation.is_credit=null,a.calculation.contributory_scheme=null),"contributory_scheme"===b&&(a.calculation.contributory_scheme=null,a.calculation.antitheft=null),"antitheft"===b&&(a.calculation.antitheft=null),e.setActiveStepSecond(b)},a.toggleOwnerRegistrationView=function(){a.carFilterParams.ownerRegistrationViewIsFull=!a.carFilterParams.ownerRegistrationViewIsFull},a.selectOwnerRegistration=function(b){b=b||a.carFilterParams.exploitation_area,a.ownerRegistration.then(function(c){var d=_.find(c,function(a){return a.id==b});m(d),a.ownerRegistrationNext()})},a.selectAntitheft=function(b){b=b||a.carFilterParams.antitheft;var c=_.find(a.calculatorParams.antiThefts,function(a){return a.id==b});l(c),a.antitheftNext()},a.selectIsEarlierInsurance=function(b){a.carFilterParams.is_earlier_insurance=b,a.isEarlierInsuranceNext()},a.selectIsCredit=function(b){a.carFilterParams.is_credit=b,a.isCreditNext()},b.getItems("antiThefts").then(function(b){a.antiThefts=_.map(b,function(a){return{id:a.id,title:a.at_mark.title+" - "+a.title}})}),a.ownerRegistration=b.getItems("exploitationArea").then(function(b){var c;return a.calculation.exploitation_area&&(c=_.find(b,function(b){return b.id==a.calculation.exploitation_area}),m(c)),a.mainRegions=_.map(p.exploitation_areas,function(a){return _.find(b,function(b){return b.id===a})}),b}),a.setCarStep=function(b){a.setCarFilterStep(b),n(a.carFilterStep),a.setActiveStep("car")},a.isInit=!1,a.carSearch={title:""},a.setCarFilterStep=function(b){a.carFilterStep=b},a.monYears=_.range(o.getFullYear(),o.getFullYear()-55,-1),a.selectMonYear=function(b){_.isNil(b)||(a.calculation.car_manufacturing_year=a.monYears[b]),i(),e.setActiveStep("car")},a.$watch("carModel",function(b){b&&(a.monYearAction=a.carModel)},!0),a.allSelected={carModel:null,carModelGroup:null,carMark:null},a.goBack=function(){n(a.carFilterStep),a.setCarFilterStep(--a.carFilterStep)}}])}(angular),function(angular){"use strict";angular.module("carFilterC").directive("carFilter",["CONSTS",function(a){return{restrict:"EA",require:"ngModel",scope:{modelCarMark:"=cfModelCarMark",modelCarModel:"=cfModelCarModel",modelCarModelGroup:"=cfModelCarModelGroup",modelCarCost:"=cfModelCarCost",isInvalid:"="},controller:"carFilterCtrl",templateUrl:a.pathToModules+"carFilterC/views/car_filter.html"}}])}(angular),function(angular){"use strict";angular.module("carFilterC").directive("carGroupModelsList",["CONSTS","Dictionary","carFilter",function(a,b,c){function d(a,c,d,e){a.carModelGroups=[],a.$watch("carMarkId",function(c){c&&(a.carModelGroups=[],b.getItems("carModelGroups",{id:c}).then(function(b){a.$parent.modelGroups=b,a.carModelGroups=b}))}),a.selectCarModelGroup=function(b){if(b)return e.$setViewValue(b.id),a.$parent.$parent.allSelected.carModelGroup=b,a.$parent.setCarFilterStep(3),!1},a.$watch(function(){return e.$viewValue},function(c,d){c&&b.getItems("carModelGroups",{id:a.carMarkId}).then(function(b){var d;d=_.find(b,function(a){return a.id===c}),a.selectCarModelGroup(d)})})}var e=c.getDefaults();return{restrict:"EA",require:"ngModel",scope:{orderBy:"@",columns:"@",carMarkId:"=",isInvalid:"=",carManufacturingYear:"="},templateUrl:a.pathToModules+"carFilterC/views/car_filter.car_group_models_list.html",compile:function(a,b){return void 0===b.columns&&(b.columns=e.columns),void 0===b.orderBy&&(b.orderBy=e.orderBy),d}}}])}(angular),function(angular){"use strict";angular.module("carFilterC").directive("carManufacturingYears",["CONSTS","carFilter",function(a,b){return{restrict:"EA",require:"ngModel",templateUrl:a.pathToModules+"carFilterC/views/car_filter.car_manufacturing_years.html"}}])}(angular),function(angular){"use strict";angular.module("carFilterC").directive("carMarksList",["CONSTS","Dictionary","carFilter",function(a,b,c){function d(a){return a>18?a<72?2:3:1}function e(a,b){var c;return!angular.isArray(a)||a.length<10?a:(c=_.map(a,function(a){return{id:a.id,rank:a.rank}}),c.sort(function(a,b){return a.rank<b.rank?1:-1}),angular.forEach(c,function(a,b){a.popularity=d(b)}),void _.forEach(a,function(a){_.find(c,function(b){var c=a.id===b.id;return c&&(a.popularity=b.popularity),c})}))}function f(a,c,d,f){a.carMarks=[],a.maxCarMarksLimit=9999,a.carMarksLimit=a.limit||g.popularCarMarks.length||g.limit,b.getItems("carMarks",{rank:"market"}).then(function(b){e(b),_.forEach(b,function(a){console.log(a.popularity)}),a.carMarks=b,a.maxCarMarksLimit=b.length}),a.toggleAllMarks=function(){a.carMarksLimit=a.carMarksLimit===a.limit?a.maxCarMarksLimit:a.limit},a.selectCarMark=function(b){if(b)return f.$setViewValue(b.id),a.$parent.allSelected.carMark=b,a.$parent.setCarFilterStep(2),angular.isFunction(a.selectHandler)&&a.selectHandler(b),!1},!g.popularCarMarks||angular.isArray(g.popularCarMarks)&&0===g.popularCarMarks.length?a.filterByPopularity=function(){return!0}:a.filterByPopularity=function(b){return!!(a.carMarksLimit!==a.limit||a.$parent.carSearch&&a.$parent.carSearch.title)||g.popularCarMarks.indexOf(b.id)!==-1},a.$watch(function(){return f.$viewValue},function(c,d){c&&b.findItem("carMarks",c).then(function(b){a.selectCarMark(b)})})}var g=c.getDefaults();return{restrict:"EA",require:"ngModel",scope:{orderBy:"@",limit:"@",columns:"@",carMarkSelected:"=ngModel",selectHandler:"=",isInvalid:"="},templateUrl:a.pathToModules+"carFilterC/views/car_filter.car_marks_list.html",compile:function(a,b){return void 0===b.limit&&(b.limit=g.popularCarMarks.length||g.limit),void 0===b.columns&&(b.columns=g.columns),void 0===b.orderBy&&(b.orderBy=g.orderBy),f}}}])}(angular),function(angular){"use strict";angular.module("carFilterC").directive("carModelsList",["CONSTS","Dictionary","carFilter","calculatorStepsService",function(a,b,c,d){function e(a,c,e,f){a.carModels=[],a.selectedModelId={},a.$watch("carModelGroupId",function(c){c&&(a.carModels=[],b.getItems("carModelsByGroup",{markId:a.carMarkId,id:c}).then(function(b){a.$parent.carModel=b,a.carModels=b}))}),a.selectCarModel=function(b,c){if(b)return c===!0&&(d.setActiveStep("engine_power"),a.$parent.$parent.isInit=!0),f.$setViewValue(b.id),a.selectedModelId=b.id,a.$parent.$parent.allSelected.carModel=b,!1},a.$watch(function(){return f.$viewValue},function(c,d){c&&b.getItems("carModelsByGroup",{markId:a.carMarkId,id:a.carModelGroupId}).then(function(b){var d;d=_.find(b,function(a){return a.id===c}),a.selectCarModel(d)})})}var f=c.getDefaults();return{restrict:"EA",require:"ngModel",scope:{orderBy:"@",columns:"@",carMarkId:"=",carModelGroupId:"=",isInvalid:"=",carManufacturingYear:"="},templateUrl:a.pathToModules+"carFilterC/views/car_filter.car_models_list.html",compile:function(a,b){return void 0===b.columns&&(b.columns=f.columns),void 0===b.orderBy&&(b.orderBy=f.orderBy),e}}}])}(angular),function(angular,a){"use strict";angular.module("carFilterC").directive("changeStep",["calculatorStepsService","$timeout",function(b,c){return{restrict:"A",template:'<div class="c-change-step"></div>',link:function(b,d,e){var f=a(d);f.addClass("c-change-step--"+e.changeStepType),"back"===e.changeStepType&&f.html('<i class="icon angle left"></i>'),f.click(function(a){a.preventDefault(),c(function(){b.$eval(e.changeStepMethod).call(null,isNaN(e.changeStep)?e.changeStep:+e.changeStep)},0)})}}}])}(angular,jQueryApp),function(angular){"use strict";angular.module("carFilterC").filter("carFilterYears",function(){return function(a,b){var c=[];a=a||[];for(var d=0,e=a.length;e>d;d++){var f=a[d].start_manufacturing_year,g=a[d].stop_manufacturing_year;b>=f&&b<=g&&c.push(a[d])}return c}})}(angular),function(angular){"use strict";angular.module("carFilterC").provider("carFilter",[function(){var a={popularCarMarks:[],limit:72,columns:6,orderBy:"title"};this.setDefaults=function(b){angular.extend(a,b)},this.$get=function(){return{getDefaults:function(){return a}}}}])}(angular),function(angular){angular.module("appMessage",[])}(angular),function(angular){angular.module("appMessage").directive("messages",["CONSTS",function(a){return{restrict:"EA",replace:!0,templateUrl:a.pathToModules+"appMessage/views/messages_template.html"}}])}(angular),function(angular){angular.module("appMessage").factory("Messages",["$rootScope","$timeout",function(a,b){function c(c,f,g,h){var i={type:c,msg:f,close:function(){e(d(this))},isList:h};a.aborting||(a.messages.push(i),void 0!==g&&g>0&&b(i.close,g))}function d(b){return a.messages.indexOf(b)}function e(b){a.messages.splice(b,1)}return a.messages=[],{error:function(a,b,d){c("error",a,b,d)},warning:function(a,b,d){c("warning",a,b,d)},info:function(a,b,d){c("info",a,b,d)},success:function(a,b,d){c("success",a,b,d)}}}])}(angular),function(angular){"use strict";angular.module("priceSlider",[])}(angular),function(angular,a){"use strict";angular.module("priceSlider").directive("priceSlider",["$timeout",function(b){function c(c,d,e,f){var g=a(d),h=a(c.popoversQuery),i=a(".car_price-bg-line"),j=g.slider({min:c.minCarPrice||0,max:c.maxCarPrice||1e6,step:1e3,slide:function(a,b){f.$setViewValue(1e3*Math.floor(b.value/1e3)),b.handle&&i.css("width",b.handle.style.left)},change:function(a,c){b(function(){c.handle&&i.css("width",c.handle.style.left)},0)},create:function(b,c){a(this).find(".ui-slider-handle").append(h)}});c.$watch(function(){return f.$viewValue},function(a,b){a&&a!==b&&(j.slider("value",a),c.modelCarCost=a)}),c.$watch("minCarPrice",function(a){void 0!==a&&(g.slider("option","min",+(a||0)),j.slider("value",f.$viewValue))}),c.$watch("maxCarPrice",function(a){void 0!==a&&(g.slider("option","max",+(a||0)),j.slider("value",f.$viewValue))}),c.changeModelCarCost=function(){f.$setViewValue(c.modelCarCost)},c.keyupModelCarCost=function(a){13===a.keyCode&&c.changeModelCarCost()},c.$on("$destroy",function(a){g.slider("destroy")})}return{restrict:"EA",require:"ngModel",link:c,scope:{minCarPrice:"=",maxCarPrice:"=",popoversQuery:"="},template:'<div hidden><div class="car_price-popover"><input price-formatter type="text" ng-model="modelCarCost" ng-keyup="keyupModelCarCost($event)" ng-blur="changeModelCarCost()" class="car_price-popover-input"><span class="car_price-popover-triangle"></span></div></div><div class="car_price-bg-line"></div><div class="car_price-min_value">{{(minCarPrice) | priceFormatter}}р.</div><div class="car_price-max_value">{{(maxCarPrice) | priceFormatter}}р.</div>'}}])}(angular,jQueryApp),function(angular){angular.module("mainContent",[])}(angular),function(angular){angular.module("policyOrderingC",[])}(angular),function(angular){"use strict";angular.module("policyOrderingC").controller("policyOrderingCtrl",["$scope","CONSTS","calculatorService","Dictionary","Messages","$timeout","addingDocumentsService","$filter","calculatorStepsService","formationPolicyService","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k){function l(){return{payment_type:"Наличными",receipt_type:"delivery",client_phone:"",client_name:"",delivery_date:"",delivery_time:"",delivery_address:"",arrival_date:"",arrival_time:""}}var m=c.calculation;m&&m.id;a.carInfo={},a.currentBrand=k.currentBrand,a.policyOrderingInProgress=!1,a.selectedResult=c.getSelectedResult(),a.calculation=m,a.dictionaryTitles={},a.formFields=l(),a.sendPolicyOrdering=function(){var b="",d=new FormData,f=a.formFields.client_name||a.calculation.client_name,i=a.formFields.client_phone||a.calculation.client_phone;return a.policyOrderingInProgress=!0,b+="Имя клиента: "+f+"\n",b+="Номер телефона клиента: "+i+"\n\n",b+="Номер расчета: "+c.calculation.id+"\n",b+="Выбранная страховая компания: "+a.selectedResult.insurance_company.title+" ("+a.selectedResult.id+")\n\n",b+="Способ оплаты: "+a.formFields.payment_type+"\n",b+="Тип получения: "+("delivery"===a.formFields.receipt_type?"Доставка":"Получение в офисе")+"\n","delivery"===a.formFields.receipt_type?(b+="Место доставки: "+a.formFields.delivery_address+"\n",b+="Желаемая дата доставки: "+a.formFields.delivery_date+"\n",b+="Желаемое время доставки: "+a.formFields.delivery_time+"\n"):(b+="Дата оформления: "+a.formFields.arrival_date+"\n",b+="Время оформления: "+a.formFields.arrival_time+"\n"),b+="Автомобиль: "+a.carInfo.carMark.title+" "+a.carInfo.carModelGroup.title+" "+a.carInfo.carModel.title+" "+m.car_manufacturing_year+" г. выпуска, "+m.engine_power+" л.с. \n",b+="Регион регистрации собственника: "+a.carInfo.owner_registration_title+"\n",b+="Страховая сумма: "+h("priceFormatter")(a.selectedResult.program.sum,2)+" рублей \n\n",j.personalData&&(b+=j.personalData),b+="Ссылка на оформление: http://enter.b2bpolis.ru/#/calculator/"+c.calculation.id+"/result/"+a.selectedResult.id+"?s=b&fp=a",d.append("message",b),g.send(d).then(function(){a.policyOrderingInProgress=!1,e.success("Ваш заказ принят. Мы свяжемся с вами в ближайшее время.",6e3),a.formFields=l()},function(){e.error("Не удалось отправить запрос.",6e3),a.policyOrderingInProgress=!1})},a.getYearRange=function(a,b){var c,d,e=new Date;return a=a||0,b=void 0===b?90:b,d=e.getFullYear()-b,c=e.getFullYear()-a,d+":"+c},a.paymentType=["Наличными","Банковской картой","Денежным переводом"],d.getItems("carModelGroups",{id:m.car_mark}).then(function(b){a.carInfo.carModelGroup=_.find(b,function(a){return a.id==m.car_model_group})}),d.getItems("ownerRegistration").then(function(b){var c=_.find(b,function(b){return b.id==a.calculation.owner_registration});c&&(a.carInfo.owner_registration_title=c.title)}),d.getItems("carModels",{id:m.car_mark}).then(function(b){a.carInfo.carMark=b.mark,a.carInfo.carModel=_.find(b.models,function(a){return a.id==m.car_model})}),d.getItems("paymentForm").then(function(b){var c=_.find(b,function(a){return a.id==_.head(m.payment_form)});a.dictionaryTitles.payment_form=c&&c.title}),a.getSelectedResult=function(){},a.templates={navigation:b.pathToModules+"calculatorC/views/navigation.html"}}])}(angular),function(angular){angular.module("brandingC",[])}(angular),function(angular){"use strict";angular.module("brandingC").service("brandingService",["CONSTS","$stateParams",function(a,b){var c={all:{other:{exploitation_area_all_are_hidden:!1,watermark_is_hidden:!0,with_sms:"on"===b.sms||!b.sms,exploitation_areas:[30261,30291],payment_forms:[{id:107,title:"У официального дилера"},{id:105,title:"Не официальные СТОА"}]},rolf:{exploitation_area_all_are_hidden:!1,watermark_is_hidden:!0,payment_form_is_hidden:!0,arrival_time_is_hidden:!0,with_sms:!1,steps_buttons_color:"red",main_buttons_color:"branded",exploitation_areas:[30261,30291],payment_forms:[{id:107,title:"У официального дилера"},{id:105,title:"Не официальные СТОА"}]},tumen:{exploitation_area_all_are_hidden:!1,watermark_is_hidden:!0,with_sms:!1,exploitation_areas:[30261,30291],payment_forms:[{id:107,title:"У официального дилера"},{id:105,title:"Не официальные СТОА"}]},barmin:{exploitation_area_all_are_hidden:!1,watermark_is_hidden:!0,addresses_are_visible:!0,with_sms:!0,steps_buttons_color:"branded",exploitation_areas:[30261,30291],payment_forms:[{id:107,title:"У официального дилера"},{id:105,title:"Не официальные СТОА"}]},block:{exploitation_area_all_are_hidden:!1,watermark_is_hidden:!0,steps_buttons_color:"branded",with_sms:!1,exploitation_areas:[30261,30291],payment_forms:[{id:107,title:"У официального дилера"},{id:105,title:"Не официальные СТОА"}]},stabilitas:{exploitation_area_all_are_hidden:!1,watermark_is_hidden:!0,steps_buttons_color:"orange",results_head_title:"Наилучшее предложение",with_sms:!1,exploitation_areas:[30261,30291],payment_forms:[{id:107,title:"У официального дилера"},{id:105,title:"Не официальные СТОА"}]},brokers:{exploitation_area_all_are_hidden:!0,watermark_is_hidden:!0,insurance_duration_is_hidden:!0,calculation_at_date_is_hidden:!0,car_cost_text:"Укажите примерную рыночную стоимость автомобиля в руб.:",sms_verification_text:"Для подтверждения что вы не робот введите свой номер телефон и код из sms.",with_sms:!0,steps_buttons_color:"branded",main_buttons_color:"branded",exploitation_areas:[30261,30291],payment_forms:[{id:107,title:"У официального дилера"},{id:105,title:"Не официальные СТОА"}]},avtoshina:{exploitation_area_all_are_hidden:!0,watermark_is_hidden:!0,steps_buttons_color:"branded",main_buttons_color:"branded",with_sms:!0,exploitation_areas:[30303],payment_forms:[{id:107,title:"У официального дилера"},{id:105,title:"Не официальные СТОА"}]}},getCurrentBrand:function(){return a.currentBrand}};return _.forEach(c.all,function(a,b){a.steps_buttons_color||(a.steps_buttons_color="blue"),a.main_buttons_color||(a.main_buttons_color="blue")}),c}])}(angular),function(angular){angular.module("AddingDocumentsC",[])}(angular),function(angular){"use strict";angular.module("AddingDocumentsC").service("addingDocumentsService",["$q","CONSTS",function(a,b){function c(){var a;try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){a=!1}}return a||"undefined"==typeof XMLHttpRequest||(a=new XMLHttpRequest),a}this.send=function(d,e){var f,g=a.defer();return f=c(),f.open("POST",b.proxyPathC+"mail.php",!0),f.onreadystatechange=function(){4==f.readyState&&(200==f.status?g.resolve(f.responseText):g.reject(e?e(f.responseText):f.responseText))},f.send(d),g.promise},this.uploader=null}])}(angular),function(angular){angular.module("preCalculatorC",[])}(angular),function(angular){"use strict";angular.module("preCalculatorC").controller("preCalculatorCtrl",["$scope","$state",function(a,b){a.typesToSelect={first:{title:"Планируете приобрести авто в РОЛЬФ",name:"first"},second:{title:"Планируете приобрести авто у другого Дилера",name:"second"}},a.preCalculatorParams={selectedType:null,is_second_step:!1,currentStep:"first",toNextSteps:function(){"first"===a.preCalculatorParams.selectedType?b.go("index.postCalculator"):b.go("index.calculator.kasko")}}}])}(angular),function(angular){angular.module("postCalculatorC",[])}(angular),function(angular){"use strict";angular.module("postCalculatorC").controller("postCalculatorCtrl",["$scope","addingDocumentsService","Messages",function(a,b,c){a.postCalculatorParams={client_name:"",client_phone:"",message:""},a.preSendToManager=function(){var d=new FormData,e="",f=a.postCalculatorParams.client_name,g=a.postCalculatorParams.client_phone,h=a.postCalculatorParams.message;e+="Клиент просит ему перезвонить.\n\n",e+="Имя клиента: "+f+"\n",e+="Телефон клиента: "+g+"\n\n",e+="Сообщение: "+h+"\n\n",d.append("message",e),b.send(d).then(function(){a.postCalculatorParams.button_is_disabled=!0,a.postCalculatorParams.is_visible=!0,c.success("Ваш запрос принят. Мы свяжемся с вами в ближайшее время.",6e3)},function(){a.postCalculatorParams.button_is_disabled=!0,c.error("Не удалось отправить запрос.",6e3)})}}])}(angular),function(angular){angular.kaskoApp=angular.module("KaskoApp",["ui.router","ui.mask","ngSanitize","ngDialog","angularFileUpload","appTemplatesKasko","utils","dictionaryC","priceFormatter","inputOnly","ngThumb","jDatePicker","calculatorC","person","formationPolicyC","dropdown","UIElements","carFilterC","appMessage","priceSlider","mainContent","policyOrderingC","brandingC","AddingDocumentsC","preCalculatorC","postCalculatorC"]);
}(angular),function(angular){"use strict";angular.kaskoApp.config(["$stateProvider","$parseProvider","$urlRouterProvider","CONSTS",function(a,b,c,d){var e=d.pathToModules,f="/kasko/",g="";7778==window.location.port&&(g="",f+="{calculationId:[0-9]*}"),c.otherwise(function(){return f?g+f:"/"}),a.state("index",{url:"?interface&sms","abstract":!0,views:{"":{controller:"baseController",templateUrl:e+"mainContent/views/main_content.html"}},resolve:{calcType:["$rootScope",function(a){a.calcType=a.calcType||"kasko"}]}}).state("index.preCalculator",{url:"/pre",controller:"preCalculatorCtrl",templateUrl:e+"preCalculatorC/views/pre_calculator.rolf.html"}).state("index.addingDocuments",{url:"/docs/",template:"<div></div>"}).state("index.ordering",{url:"/ordering/",template:"<div></div>"}).state("index.postCalculator",{url:"/get-best-offer",controller:"postCalculatorCtrl",templateUrl:e+"postCalculatorC/views/post_calculator.rolf.html"}).state("index.calculator",{url:g,"abstract":!0,reloadOnSearch:!0,controller:"calculatorCtrl",templateUrl:e+"calculatorC/views/calculator.html"}).state("index.calculator.kasko",{url:f,data:{title:"Расчет ОСАГО"},views:{"":{controller:"calculatorCascoCtrl",templateUrl:e+"calculatorC/views/calculation.form.html"},"step_2@index.calculator.kasko":{templateUrl:e+"calculatorC/views/kasko/calculation.step_2.html"},"step_3@index.calculator.kasko":{templateUrl:e+"calculatorC/views/kasko/calculation.step_3.html"},"step_6@index.calculator.kasko":{templateUrl:e+"calculatorC/views/kasko/calculation.step_6.html"}}})}])}(angular),function(angular){"use strict";angular.kaskoApp.controller("baseController",["$stateParams","$rootScope","brandingService",function(a,b,c){a["interface"]&&(b["interface"]=a["interface"]),b.currentBrandName=a["interface"]||c.getCurrentBrand(),b.currentBrand=c.all[b.currentBrandName]}])}(angular),function(angular){"use strict";angular.kaskoApp.config(["DictionaryProvider","CONSTS","ngThumbProvider","jdatepickerProvider","calculatorProvider","carFilterProvider","$compileProvider","$locationProvider",function(a,b,c,d,e,f,g,h){a.setConstants(b),window.location.port&&80!=window.location.port||g.debugInfoEnabled(!1),h.hashPrefix("!"),c.setPdfIcon(b.prefixPath+"img/pdf.png"),d.setDefaults({dateFormat:"dd.mm.yy",pDateFormat:"yy-mm-dd",mDateFormat:"yy-mm-dd",replacedSymbols:{"/":".",",":"."},inputRule:function(a){var b,c,d=/([\d]{0,2})(\.?)([\d]{0,2})(\.?)([\d]{0,4})/;return c=d.exec(a),b=a,c&&(b="",c[1]&&(b=c[1],(2==c[1].length||c[3])&&(b+=".")),c[3]&&(b+=c[3],(2==c[3].length||c[5])&&(b+=".")),b+=c[5]),b}}),f.setDefaults({popularCarMarks:[4740,291,294,4737,297,303,3763,456,312,315,318,324,40612,330,333,336,339,3908,342,35526,345,348,351,354,357,360,363,366,372,375,3911,585,381,384,390,393,396,399,402,411,414,30590,426,429,432,435,438,441,444,447,450,552,33327,555,564,558]})}])}(angular),function(angular){"use strict";angular.kaskoApp.constant("CONSTS",function(){var a={host:"",hostApi:"",prefixPath:"",proxyPath:"",proxyPathC:"",currentBrand:""};return AngularAppConfig&&(AngularAppConfig.host&&(a.host=AngularAppConfig.host),AngularAppConfig.hostApi&&(a.hostApi=AngularAppConfig.hostApi),AngularAppConfig.prefixPath&&(a.prefixPath=AngularAppConfig.prefixPath),AngularAppConfig.proxyPath&&(a.proxyPath=AngularAppConfig.proxyPath),a.proxyPathC=AngularAppConfig.proxyPathC||a.proxyPath,AngularAppConfig.currentBrand?a.currentBrand=AngularAppConfig.currentBrand:a.currentBrand="other"),angular.extend(a,{pathToSource:a.prefixPath+"js/src/",pathToModules:a.prefixPath+"js/src/modules/",urlPrefix:a.host+"/rest/v1/",urlPrefixDefault:a.host+"/rest/default/",urlPrefixV3:a.host+"/rest/v3/default/",urlPrefixV3Client:a.host+"/rest/v1/client/",urlPrefixCalc:a.host+"/rest/full/",urlPrefixPolicy:a.host+"/policy/rest/",urlPrefixApi:a.hostApi+"/api/"}),a}())}(angular),function(angular){"use strict";angular.kaskoApp.service("resources",["CONSTS",function(a){this.deal=a.urlPrefix+"deal/deal",this.person=a.urlPrefix+"client/person",this.customer=a.urlPrefix+"client/customer",this.obtainToken=a.urlPrefix+"accounts/obtain-token",this.legalPerson=a.urlPrefix+"client/legal-person",this.customerCar=a.urlPrefix+"client/car",this.currentUser=a.urlPrefix+"accounts/user/current",this.calculation=a.urlPrefixCalc+"calculation/",this.resultPolicy=a.urlPrefixPolicy+"result_policy/",this.naturalPerson=a.urlPrefix+"client/natural-person",this.insuredObject=a.urlPrefixDefault+"client/insured-object-create",this.insuredObjectOsago=a.urlPrefixDefault+"client/insured-object-osago-create",this.calculationV3=a.urlPrefixV3+"calculation/",this.userActivation=a.urlPrefix+"registration/activation",this.calculationList=a.urlPrefixV3+"calculation/list/",this.insuredObectList=a.urlPrefix+"client/insured-object",this.insuredObjectCRM=a.urlPrefix+"client/insured-object",this.notificationSend=a.urlPrefix+"notification/send",this.userRegistration=a.urlPrefix+"registration/registration",this.insuranceProduct=a.urlPrefix+"deal/insurance-product",this.savedCars=a.urlPrefix+"client/car",this.savedNaturalPersons=a.urlPrefix+"client/natural-person",this.savedLegalPersons=a.urlPrefix+"client/legal-person"}])}(angular),function(angular,a){"use strict";angular.kaskoApp.run(["$rootScope","$state","$injector","$http","CONSTS","$location","ngDialog",function(a,b,c,d,e,f,g){var h,i=f.path;_.mixin({isPromise:function(a){return a&&_.isFunction(a.then)}}),a.$on("$stateChangeStart",function(b,c,d,e,f){a.lastState=c,a.lastState.toParams=d}),a.$on("$stateChangeSuccess",function(b,c,d,e){a.$previousState=e,a.$activeState=c,h&&(g.close(h),h=null)}),a.$on("ngDialog.opened",function(a,b){h=b.attr("id")}),a.cancellerRequests=[],a.cancelAllRequests=function(){angular.forEach(a.cancellerRequests,function(a){a.resolve()}),a.cancellerRequests.length=0},f.path=function(c,d){if(d===!1)var e=b.current,g=a.$on("$stateChangeSuccess",function(){b.current=e,g()});return i.apply(f,[c])},a.prefixPath=e.prefixPath}])}(angular,jQueryApp);